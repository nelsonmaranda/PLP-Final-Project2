import{u as B,j as e,a as u,b as H}from"./index-DYoPkzMu.js";import{r}from"./vendor-BKU87Gzz.js";import{L as d}from"./router-Z6rqMkFf.js";import{M as F,B as W,f as L,c as M,g as O,k as _,l as q,A as K,m as V,D as P,W as Z,T as U,N as Y,n as z,E as G,C as $,Z as J}from"./icons-laTIaZ17.js";function Q(t,s,j={}){const{revalidateOnFocus:m=!0,revalidateOnReconnect:o=!0,refreshInterval:b=0,retryCount:x=3,retryDelay:i=1e3,onError:l}=j,[D,S]=r.useState(void 0),[E,N]=r.useState(void 0),[T,p]=r.useState(!1),[k,f]=r.useState(!1),c=r.useCallback(async(n=!1)=>{n||p(!0),f(!0),N(void 0);let y=0;const R=x+1;for(;y<R;)try{const g=await s();S(g),N(void 0);break}catch(g){y++;const w=g instanceof Error?g:new Error("Unknown error");y>=R?(N(w),l==null||l(w)):await new Promise(a=>setTimeout(a,i*Math.pow(2,y-1)))}p(!1),f(!1)},[t,s,x,i,l]),v=r.useCallback(async()=>{await c(!0)},[c]);return r.useEffect(()=>{c()},[c]),r.useEffect(()=>{if(b>0){const n=setInterval(()=>{c(!0)},b);return()=>clearInterval(n)}},[c,b]),r.useEffect(()=>{if(!m)return;const n=()=>{c(!0)};return window.addEventListener("focus",n),()=>window.removeEventListener("focus",n)},[c,m]),r.useEffect(()=>{if(!o)return;const n=()=>{c(!0)};return window.addEventListener("online",n),()=>window.removeEventListener("online",n)},[c,o]),{data:D,error:E,isLoading:T,isValidating:k,mutate:v}}function X(){const{t}=B(),[s,j]=r.useState("loading"),{data:m}=Q("homepage-analytics",()=>u.getHomepageAnalytics(),{retryCount:3,retryDelay:1e3,refreshInterval:3e4,onError:i=>console.warn("Analytics fetch failed:",i)});r.useEffect(()=>{(async()=>{try{const l=await u.getHealth();j(l!=null&&l.success?"online":"offline")}catch{j("offline")}})()},[]);const o=(m==null?void 0:m.data)||{totalRoutes:0,totalReports:0,averageScore:0,totalUsers:0},b=[{label:t("home.activeRoutes"),value:o.totalRoutes.toLocaleString(),icon:F},{label:t("home.reportsToday"),value:o.totalReports.toLocaleString(),icon:W},{label:t("home.safetyRating"),value:`${(o.averageScore||0).toFixed(1)}★`,icon:L},{label:t("home.activeUsers"),value:o.totalUsers.toLocaleString(),icon:M}],x=[{title:t("home.realTimeTracking"),description:t("home.realTimeTrackingDesc"),icon:O},{title:t("home.safetyReports"),description:t("home.safetyReportsDesc"),icon:L},{title:t("home.reliabilityScores"),description:t("home.reliabilityScoresDesc"),icon:_},{title:t("home.communityInsights"),description:t("home.communityInsightsDesc"),icon:M}];return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("section",{className:"hero",role:"banner",children:e.jsx("div",{className:"hero-content",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-gray-900 mb-6",children:t("home.title")}),e.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-3xl mx-auto",children:t("home.subtitle")}),e.jsxs("div",{className:"mb-8",role:"status","aria-live":"polite",children:[s==="loading"&&e.jsxs("div",{className:"inline-flex items-center px-4 py-2 rounded-full bg-yellow-100 text-yellow-800",children:[e.jsx("div",{className:"loading-spinner mr-2","aria-hidden":"true"}),t("home.checkingStatus")]}),s==="online"&&e.jsx("div",{className:"status-online",children:t("home.systemOnline")}),s==="offline"&&e.jsx("div",{className:"status-offline",children:t("home.systemOffline")})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(d,{to:"/map",className:"btn btn-primary btn-lg",children:[t("home.viewMap"),e.jsx(q,{className:"w-5 h-5 ml-2","aria-hidden":"true"})]}),e.jsx(d,{to:"/report",className:"btn btn-outline btn-lg",children:t("home.reportTrip")})]})]})})}),e.jsx("section",{className:"section bg-white","aria-labelledby":"stats-heading",children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{id:"stats-heading",className:"sr-only",children:"Platform Statistics"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:b.map(i=>{const l=i.icon;return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-primary-100 rounded-lg mb-4",children:e.jsx(l,{className:"w-6 h-6 text-primary-600","aria-hidden":"true"})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i.value}),e.jsx("div",{className:"text-sm text-gray-600",children:i.label})]},i.label)})})]})}),e.jsx("section",{className:"section bg-gray-50","aria-labelledby":"features-heading",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{id:"features-heading",className:"text-3xl font-bold text-gray-900 mb-4",children:t("home.howItWorks")}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:t("home.howItWorksDesc")})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:x.map(i=>{const l=i.icon;return e.jsx("article",{className:"card",children:e.jsxs("div",{className:"card-content text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-secondary-100 rounded-lg mb-4",children:e.jsx(l,{className:"w-6 h-6 text-secondary-600","aria-hidden":"true"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:i.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:i.description})]})},i.title)})})]})}),e.jsx("section",{className:"section bg-primary-600","aria-labelledby":"cta-heading",children:e.jsxs("div",{className:"container text-center",children:[e.jsx("h2",{id:"cta-heading",className:"text-3xl font-bold text-white mb-4",children:t("home.readyToStart")}),e.jsx("p",{className:"text-xl text-primary-100 mb-8 max-w-2xl mx-auto",children:t("home.readyToStartDesc")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(d,{to:"/signup",className:"btn btn-secondary btn-lg",children:t("home.signUpNow")}),e.jsx(d,{to:"/map",className:"btn btn-outline btn-lg text-white border-white hover:bg-white hover:text-primary-600",children:t("home.exploreMap")})]})]})})]})}function ee(){var w;const{state:t}=H(),{t:s}=B(),[j,m]=r.useState(!0),[o,b]=r.useState(null),[x,i]=r.useState(null),[l,D]=r.useState(null),[S,E]=r.useState([]),[N,T]=r.useState([]),[p,k]=r.useState([]),[f]=r.useState(10),c=7,v=r.useCallback(async()=>{if(t.user){m(!0),b(null);try{const[a,h,I,A,C]=await Promise.all([u.getDashboardStats(),u.getWeatherData(),u.getRouteInsights({limit:f,days:c}),u.getFavoriteRoutes(t.user._id),u.getUserReports(t.user._id)]);a.success&&a.data&&i(a.data),h.success&&h.data&&D(h.data),I.success&&I.data&&E(I.data.insights),A.success&&A.data&&T(A.data.routes),C.success&&C.data&&k(C.data.reports.slice(0,5))}catch(a){console.error("Error loading dashboard data:",a),b("Failed to load dashboard data. Please try again.")}finally{m(!1)}}},[t.user,f]);r.useEffect(()=>{v()},[v]);const n=a=>{const h=a.toLowerCase();return h.includes("rain")?e.jsx(P,{className:"w-6 h-6 text-blue-500"}):h.includes("cloud")?e.jsx($,{className:"w-6 h-6 text-gray-500"}):h.includes("sun")?e.jsx(J,{className:"w-6 h-6 text-yellow-500"}):e.jsx($,{className:"w-6 h-6 text-gray-500"})},y=a=>{switch(a){case"low":return"text-green-600 bg-green-100";case"medium":return"text-yellow-600 bg-yellow-100";case"high":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},R=a=>{switch(a){case"low":return s("dashboard.crowdLow");case"medium":return s("dashboard.crowdMedium");case"high":return s("dashboard.crowdHigh");default:return`${a} ${s("dashboard.crowdSuffix")}`}},g=a=>a>=4?"text-green-600":a>=3?"text-yellow-600":"text-red-600";return j?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:s("dashboard.loadingYourDashboard")})]})}):o?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:s("dashboard.errorTitle")}),e.jsx("p",{className:"text-gray-600 mb-4",children:o}),e.jsx("button",{onClick:v,className:"btn btn-primary",children:s("dashboard.tryAgain")})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[s("dashboard.welcome"),", ",(w=t.user)==null?void 0:w.displayName,"!"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.headerSubtitle")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("en-KE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:new Date().toLocaleTimeString("en-KE",{hour:"2-digit",minute:"2-digit"})})]})]})})}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8",children:[l&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s("dashboard.currentWeather")}),n(l.condition)]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-2xl font-bold",children:[l.temperature,"°C"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsxs("span",{children:[l.humidity,"% ",s("dashboard.humidityLabel")]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsxs("span",{children:[l.windSpeed," ",s("dashboard.windSpeedLabel")]})]}),e.jsx("p",{className:"text-sm opacity-90",children:l.condition})]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.activeRoutesTitle")}),e.jsx(F,{className:"w-6 h-6 text-primary-500"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-2",children:x.totalRoutes}),e.jsx("p",{className:"text-sm text-gray-600",children:s("dashboard.routesMonitored")})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.avgFareTitle")}),e.jsx(U,{className:"w-6 h-6 text-green-500"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900 mb-2",children:["KES ",x.averageFare]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("dashboard.currentAverage")})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.safetyRating")}),e.jsx(L,{className:"w-6 h-6 text-blue-500"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900 mb-2",children:[x.safetyRating.toFixed(1),"/5"]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("dashboard.overallSafety")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("dashboard.smartRouteInsights")}),e.jsx(d,{to:"/map",className:"btn btn-ghost btn-sm",children:s("dashboard.viewAllRoutesBtn")})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.aiRecommendations")})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4"}),S.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:s("dashboard.noInsights")}),e.jsx(d,{to:"/map",className:"btn btn-primary",children:s("dashboard.exploreRoutes")})]}):e.jsx("div",{className:"space-y-4",children:S.slice(0,5).map((a,h)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a.routeName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s("dashboard.routeIdLabel"),": ",a.routeId]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${y(a.crowdDensity.level)}`,children:R(a.crowdDensity.level)})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-4 h-4 text-green-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:["KES ",a.farePrediction.predictedFare]}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.predictedFareLabel")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:`w-4 h-4 ${g(a.safetyScore.overallScore)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:`font-medium ${g(a.safetyScore.overallScore)}`,children:[a.safetyScore.overallScore.toFixed(1),"/5"]}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.safetyScoreLabel")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[a.travelTime," min"]}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.travelTimeLabel")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-4 h-4 text-purple-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.recommendedTime}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.bestTimeLabel")})]})]})]})]},h))})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.favoriteRoutes")})}),e.jsx("div",{className:"p-6",children:N.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(_,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:s("dashboard.noFavorites")}),e.jsx(d,{to:"/map",className:"btn btn-ghost btn-sm",children:s("dashboard.viewAllRoutesBtn")})]}):e.jsx("div",{className:"space-y-3",children:N.slice(0,3).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[s("dashboard.routeLabel")," ",a.routeNumber]}),e.jsx("div",{className:"text-sm text-gray-600",children:a.name})]}),e.jsx(d,{to:`/map?route=${a._id}`,className:"btn btn-ghost btn-sm",children:s("dashboard.viewLabel")})]},a._id))})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.recentReports")})}),e.jsx("div",{className:"p-6",children:p.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(W,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:s("dashboard.noReports")}),e.jsx(d,{to:"/report",className:"btn btn-ghost btn-sm",children:s("dashboard.submitReportBtn")})]}):e.jsx("div",{className:"space-y-3",children:p.slice(0,3).map(a=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:a.reportType}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(a.createdAt).toLocaleDateString()})]})]},a._id))})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.quickActions")})}),e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsxs(d,{to:"/map",className:"flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(F,{className:"w-5 h-5 text-primary-500"}),e.jsx("span",{className:"text-gray-900",children:s("dashboard.quickViewMap")})]}),e.jsxs(d,{to:"/report",className:"flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(W,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-gray-900",children:s("dashboard.quickSubmitReport")})]}),e.jsxs(d,{to:"/profile",className:"flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(G,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"text-gray-900",children:s("dashboard.quickViewProfile")})]})]})]})]})]})]})]})}function le(){const{state:t}=H();return t.isAuthenticated?e.jsx(ee,{}):e.jsx(X,{})}export{le as default};
//# sourceMappingURL=HomePage-mxsMXR5G.js.map
