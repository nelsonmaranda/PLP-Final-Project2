import{u as ee,a as o,j as e}from"./index-N0cMQqFc.js";import{r as i}from"./vendor-BKU87Gzz.js";import{q as se,A as D,R as z,O as te,g as O,T as ae,l as U,F as I,y as le,Z as ie,Q as ce,n as ne,V as re,Y as de,_ as me}from"./icons-B_aqzpWL.js";import"./router-Z6rqMkFf.js";function je(){var _;const{state:g}=ee(),[L,m]=i.useState(!0),[R,n]=i.useState(null),[h,M]=i.useState("efficiency"),[Z,T]=i.useState([]),[Y,C]=i.useState([]),[A,F]=i.useState([]),[q,P]=i.useState([]),[$,E]=i.useState([]),[f,k]=i.useState(null),[u,N]=i.useState([]),[c,v]=i.useState(""),[j,B]=i.useState([]),[r,y]=i.useState(""),[d,b]=i.useState(""),[p,K]=i.useState("08:00"),[w,Q]=i.useState("weekly");i.useEffect(()=>{(async()=>{try{const t=await o.getRoutes({page:1,limit:200,sort:"name",order:"asc"});if(t.success&&t.data&&t.data.routes){const l=t.data.routes.map(a=>({_id:a._id,name:a.name,routeNumber:a.routeNumber,stops:a.stops}));N(l)}else N([])}catch(t){console.error("Failed to load routes for analytics",t),N([])}})()},[]),i.useEffect(()=>{var l;const s=u.find(a=>a._id===c),t=((l=s==null?void 0:s.stops)==null?void 0:l.map(a=>a.name))||[];B(t),y(a=>t.includes(a)?a:""),b(a=>t.includes(a)?a:"")},[c,u]);const x=i.useCallback(async()=>{var s;if(!((s=g.user)!=null&&s._id)){n("User not authenticated."),m(!1);return}m(!0),n(null);try{const t=await o.getUserRecommendations(g.user._id);if(t.success&&t.data?k(t.data):k(null),c){const[l,a,S]=await Promise.all([o.getRouteEfficiency(c),o.analyzeTrends(c,w),o.forecastDemand(c,p)]);T(l.success&&l.data?[l.data]:[]),P(a.success&&a.data?[a.data]:[]),E(S.success&&S.data?[S.data]:[])}else T([]),P([]),E([]);F([]),C([])}catch(t){console.error("Error loading analytics data:",t),n("Failed to load analytics data. Please try again.")}finally{m(!1)}},[(_=g.user)==null?void 0:_._id,c,w,p]);i.useEffect(()=>{x()},[x]);const V=async()=>{try{if(!c||!r||!d){n("Please select a route, From stop, and To stop.");return}m(!0),n(null);const s=await o.predictTravelTime(c,r,d,p);C(s.success&&s.data?[s.data]:[])}catch(s){console.error(s),n("Failed to predict travel time.")}finally{m(!1)}},W=async()=>{try{if(!r||!d){n("Please select From and To stops to find alternatives.");return}m(!0),n(null);const s=await o.findAlternativeRoutes(r,d);F(s.success&&s.data?s.data.alternatives:[])}catch(s){console.error(s),n("Failed to fetch alternative routes.")}finally{m(!1)}},G=s=>{switch(s){case"increasing":case"improving":case"safer":return e.jsx(me,{className:"w-4 h-4 text-green-500"});case"decreasing":case"declining":case"riskier":return e.jsx(de,{className:"w-4 h-4 text-red-500"});default:return e.jsx(re,{className:"w-4 h-4 text-gray-500"})}},H=s=>{switch(s){case"increasing":case"improving":case"safer":return"text-green-600";case"decreasing":case"declining":case"riskier":return"text-red-600";default:return"text-gray-600"}},J=s=>s>=80?"text-green-600":s>=60?"text-yellow-600":"text-red-600",X=s=>s>=80?"bg-green-100":s>=60?"bg-yellow-100":"bg-red-100";return L?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{className:"h-10 w-10 text-primary-500 animate-spin"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading Advanced Analytics..."})]})}):R?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center p-6 bg-white rounded-lg shadow-md",children:[e.jsx(D,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Error Loading Analytics"}),e.jsx("p",{className:"text-gray-600 mb-4",children:R}),e.jsxs("button",{onClick:x,className:"btn btn-primary",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Retry"]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"px-6 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Advanced Analytics"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive insights and predictions for route optimization"})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"efficiency",name:"Route Efficiency",icon:te},{id:"predictions",name:"Travel Predictions",icon:O},{id:"trends",name:"Trend Analysis",icon:ae},{id:"recommendations",name:"Recommendations",icon:U}].map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>M(s.id),className:`flex items-center space-x-2 py-2 px-1 border-b-2 font-medium text-sm ${h===s.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(t,{className:"w-4 h-4"}),e.jsx("span",{children:s.name})]},s.id)})})})}),e.jsxs("div",{className:"space-y-6",children:[h==="efficiency"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Route Efficiency Scores"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:c,onChange:s=>v(s.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Select a route"}),u.map(s=>e.jsx("option",{value:s._id,children:s.routeNumber?`${s.routeNumber} - ${s.name}`:s.name},s._id))]}),e.jsxs("button",{className:"btn btn-outline",onClick:x,disabled:!c,children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:Z.map(s=>e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.routeName}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${X(s.efficiencyScore)} ${J(s.efficiencyScore)}`,children:[s.efficiencyScore,"/100"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(s.factors).map(([t,l])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 capitalize",children:t}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-500 h-2 rounded-full",style:{width:`${l}%`}})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:l})]})]},t))}),s.recommendations.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Recommendations"}),e.jsx("ul",{className:"space-y-1",children:s.recommendations.map((t,l)=>e.jsxs("li",{className:"flex items-start space-x-2 text-sm text-gray-600",children:[e.jsx(le,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:t})]},l))})]})]})]},s.routeId))})]}),h==="predictions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Travel Time Predictions"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:c,onChange:s=>v(s.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Select route"}),u.map(s=>e.jsx("option",{value:s._id,children:s.routeNumber?`${s.routeNumber} - ${s.name}`:s.name},s._id))]}),e.jsxs("select",{value:r,onChange:s=>y(s.target.value),className:"form-select",disabled:!c,children:[e.jsx("option",{value:"",children:"From stop"}),j.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:d,onChange:s=>b(s.target.value),className:"form-select",disabled:!c,children:[e.jsx("option",{value:"",children:"To stop"}),j.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx("input",{type:"time",value:p,onChange:s=>K(s.target.value),className:"form-input"}),e.jsxs("button",{className:"btn btn-primary",onClick:V,disabled:!c||!r||!d,children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Predict"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:Y.map((s,t)=>e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[s.fromStop," â†’ ",s.toStop]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary-600",children:[s.predictedTime," min"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.confidence,"% confidence"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[s.alternativeTimes.optimistic," min"]}),e.jsx("div",{className:"text-xs text-green-600",children:"Optimistic"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-semibold text-blue-600",children:[s.alternativeTimes.realistic," min"]}),e.jsx("div",{className:"text-xs text-blue-600",children:"Realistic"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-semibold text-red-600",children:[s.alternativeTimes.pessimistic," min"]}),e.jsx("div",{className:"text-xs text-red-600",children:"Pessimistic"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Factors"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:Object.entries(s.factors).map(([l,a])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 capitalize",children:l.replace(/([A-Z])/g," $1")}),e.jsxs("span",{className:"font-medium",children:[a.toFixed(2),"x"]})]},l))})]})]})]},t))}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Alternative Routes"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:r,onChange:s=>y(s.target.value),className:"form-select",disabled:!c,children:[e.jsx("option",{value:"",children:"From stop"}),j.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:d,onChange:s=>b(s.target.value),className:"form-select",disabled:!c,children:[e.jsx("option",{value:"",children:"To stop"}),j.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("button",{className:"btn btn-outline",onClick:W,disabled:!r||!d,children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Find"]})]})]}),A.length>0&&e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:A.map((s,t)=>e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.routeName}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.efficiency,"/100"]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.totalTime," min"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsxs("span",{children:["Ksh ",s.totalCost]})]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"text-xs text-gray-500",children:["Reasons: ",s.reasons.join(", ")]})})]},t))})]})]}),h==="trends"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Trend Analysis"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:c,onChange:s=>v(s.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Select route"}),u.map(s=>e.jsx("option",{value:s._id,children:s.routeNumber?`${s.routeNumber} - ${s.name}`:s.name},s._id))]}),e.jsxs("select",{value:w,onChange:s=>Q(s.target.value),className:"form-select",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]}),e.jsxs("button",{className:"btn btn-outline",onClick:x,disabled:!c,children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Update"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:q.map((s,t)=>e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Route Trends (",s.period,")"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(s.trends).map(([l,a])=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900 capitalize",children:l}),e.jsxs("div",{className:"flex items-center space-x-2",children:[G(a.trend),e.jsxs("span",{className:`text-sm font-medium ${H(a.trend)}`,children:[a.change>0?"+":"",a.change.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Current: ",a.current]}),e.jsxs("span",{children:["Previous: ",a.previous]})]})]},l))}),s.insights.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Insights"}),e.jsx("ul",{className:"space-y-1",children:s.insights.map((l,a)=>e.jsxs("li",{className:"flex items-start space-x-2 text-sm text-gray-600",children:[e.jsx(D,{className:"w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:l})]},a))})]})]},t))})]}),h==="recommendations"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Personalized Recommendations"}),e.jsxs("button",{className:"btn btn-primary",onClick:x,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),f&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Your Preferences"}),e.jsx("div",{className:"space-y-3",children:Object.entries(f.preferences).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 capitalize",children:s}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-500 h-2 rounded-full",style:{width:`${t*100}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[Math.round(t*100),"%"]})]})]},s))})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recommended Routes"}),e.jsx("div",{className:"space-y-3",children:f.recommendations.map((s,t)=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.routeName}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[s.score,"/100"]})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.reason}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${s.type==="efficiency"?"bg-blue-100 text-blue-800":s.type==="safety"?"bg-green-100 text-green-800":s.type==="cost"?"bg-yellow-100 text-yellow-800":"bg-purple-100 text-purple-800"}`,children:s.type})})]},t))})]})]}),$.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Demand Forecasts"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:$.map((s,t)=>e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-semibold text-gray-900",children:["Time Slot: ",s.timeSlot]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-primary-600",children:[s.predictedDemand,"%"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.confidence,"% confidence"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:e.jsx("div",{className:"bg-primary-500 h-2 rounded-full",style:{width:`${s.predictedDemand}%`}})}),s.recommendations.length>0&&e.jsx("div",{className:"text-sm text-gray-600",children:s.recommendations[0]})]},t))})]})]})]})]})})}export{je as default};
//# sourceMappingURL=AnalyticsDashboard-C3CmkrLO.js.map
