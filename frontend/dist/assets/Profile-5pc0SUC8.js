import{u as V,a as n,j as e}from"./index-N0cMQqFc.js";import{r as a}from"./vendor-BKU87Gzz.js";import{L as c}from"./router-Z6rqMkFf.js";import{U as g,x as X,e as j,d as N,B as J,A as O,y as Q,z as W,X as T,M as Z,g as D,l as ee}from"./icons-B_aqzpWL.js";function le(){var k,L;const{state:t,setUser:_}=V(),[i,M]=a.useState("profile"),[d,o]=a.useState(!1),[y,f]=a.useState(!1),[b,m]=a.useState(null),[U,x]=a.useState(!1),[u,I]=a.useState({displayName:((k=t.user)==null?void 0:k.displayName)||"",email:((L=t.user)==null?void 0:L.email)||""}),[v,z]=a.useState([]),[Y,w]=a.useState(!1),[R,S]=a.useState([]),[$,C]=a.useState(!1),[l,q]=a.useState({totalReports:0,reportsThisMonth:0,favoriteRoutesCount:0,averageRating:0,mostReportedRoute:null}),F=a.useCallback(async()=>{if(t.user){w(!0);try{const s=await n.getUserReports(t.user._id);s.success&&s.data&&z(s.data.reports||[])}catch(s){console.error("Error loading reports:",s)}finally{w(!1)}}},[t.user]),A=a.useCallback(async()=>{if(t.user){C(!0);try{const s=await n.getFavoriteRoutes(t.user._id);s.success&&s.data&&S(s.data.routes||[])}catch(s){console.error("Error loading favorites:",s)}finally{C(!1)}}},[t.user]),E=a.useCallback(async()=>{if(t.user)try{const s=await n.getUserAnalytics(t.user._id);s.success&&s.data&&q(s.data)}catch(s){console.error("Error loading analytics:",s)}},[t.user]);a.useEffect(()=>{t.user&&(F(),A(),E())},[t.user,F,A,E]);const B=async s=>{if(s.preventDefault(),!!t.user){f(!0),m(null),x(!1);try{const r=await n.updateProfile(t.user._id,u);r.success&&r.data?(_(r.data.user),x(!0),o(!1),setTimeout(()=>x(!1),3e3)):m("Failed to update profile. Please try again.")}catch(r){console.error("Profile update error:",r),m("Failed to update profile. Please try again.")}finally{f(!1)}}},P=s=>{const{name:r,value:h}=s.target;I(p=>({...p,[r]:h}))},H=async s=>{if(t.user)try{(await n.removeFavoriteRoute(t.user._id,s)).success&&S(h=>h.filter(p=>p._id!==s))}catch(r){console.error("Error removing favorite:",r)}},K=s=>new Date(s).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),G=s=>{switch(s){case"low":return"text-green-600 bg-green-100";case"medium":return"text-yellow-600 bg-yellow-100";case"high":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};return t.user?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-primary-500 rounded-full flex items-center justify-center",children:e.jsx(g,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.user.displayName}),e.jsx("p",{className:"text-gray-600",children:t.user.email}),e.jsxs("p",{className:"text-sm text-gray-500 capitalize",children:["Role: ",t.user.role]})]}),e.jsxs("button",{onClick:()=>o(!d),className:"btn btn-ghost btn-sm",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),d?"Cancel":"Edit Profile"]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",children:[{id:"profile",name:"Profile",icon:g},{id:"reports",name:"My Reports",icon:j},{id:"favorites",name:"Favorites",icon:N},{id:"analytics",name:"Analytics",icon:J}].map(s=>{const r=s.icon;return e.jsxs("button",{onClick:()=>M(s.id),className:`py-4 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ${i===s.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(r,{className:"w-4 h-4"}),e.jsx("span",{children:s.name})]},s.id)})})}),e.jsxs("div",{className:"p-6",children:[i==="profile"&&e.jsx("div",{children:d?e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[b&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm text-red-800",children:b})]})}),U&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Q,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-800",children:"Profile updated successfully!"})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Name"}),e.jsx("input",{type:"text",id:"displayName",name:"displayName",value:u.displayName,onChange:P,className:"input w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",name:"email",value:u.email,onChange:P,className:"input w-full",required:!0})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:y,className:"btn btn-primary",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Save Changes"]})}),e.jsxs("button",{type:"button",onClick:()=>o(!1),className:"btn btn-ghost",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Account Information"}),e.jsxs("dl",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Display Name"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.user.displayName})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Email Address"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.user.email})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Account Type"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 capitalize",children:t.user.role})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Member Since"}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:new Date(t.user.createdAt||Date.now()).toLocaleDateString("en-KE")})]})]})]})})}),i==="reports"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"My Trip Reports"}),Y?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(j,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No reports submitted yet"}),e.jsx(c,{to:"/report",className:"btn btn-primary",children:"Submit Your First Report"})]}):e.jsx("div",{className:"space-y-4",children:v.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Z,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["Route ",s.routeId]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${G(s.severity)}`,children:s.severity})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),K(s.createdAt)]}),e.jsxs("span",{className:"capitalize",children:["Type: ",s.reportType]})]})]})})},s._id))})]}),i==="favorites"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Favorite Routes"}),$?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):R.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(N,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No favorite routes yet"}),e.jsx(c,{to:"/map",className:"btn btn-primary",children:"Explore Routes"})]}):e.jsx("div",{className:"space-y-4",children:R.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.operator}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Route ",s.routeNumber]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{to:`/map?route=${s._id}`,className:"btn btn-ghost btn-sm",children:"View"}),e.jsx("button",{onClick:()=>H(s._id),className:"btn btn-ghost btn-sm text-red-600 hover:text-red-700",children:e.jsx(T,{className:"w-4 h-4"})})]})]})},s._id))})]}),i==="analytics"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Your Analytics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Total Reports"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:l.totalReports})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"This Month"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:l.reportsThisMonth})]})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Favorites"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:l.favoriteRoutesCount})]})]})}),e.jsx("div",{className:"bg-yellow-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Avg Rating"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:l.averageRating.toFixed(1)})]})]})})]}),l.mostReportedRoute&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Most Reported Route"}),e.jsx("p",{className:"text-sm text-gray-600",children:l.mostReportedRoute})]})]})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Please log in"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You need to be logged in to view your profile."}),e.jsx(c,{to:"/login",className:"btn btn-primary",children:"Go to Login"})]})})}export{le as default};
//# sourceMappingURL=Profile-5pc0SUC8.js.map
