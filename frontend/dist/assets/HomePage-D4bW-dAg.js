import{u as O,j as e,a as u,b as _}from"./index-BfH27FKw.js";import{r}from"./vendor-BKU87Gzz.js";import{L as n}from"./router-Z6rqMkFf.js";import{M as C,B as F,f as R,c as W,g as $,k as q,l as B,A as H,m as K,D as P,W as V,T as U,N as Z,n as Y,E as z,C as M,Z as G}from"./icons-laTIaZ17.js";function J(a,s,j={}){const{revalidateOnFocus:m=!0,revalidateOnReconnect:x=!0,refreshInterval:b=0,retryCount:h=3,retryDelay:i=1e3,onError:l}=j,[L,S]=r.useState(void 0),[D,N]=r.useState(void 0),[E,p]=r.useState(!1),[T,f]=r.useState(!1),c=r.useCallback(async(d=!1)=>{d||p(!0),f(!0),N(void 0);let y=0;const w=h+1;for(;y<w;)try{const g=await s();S(g),N(void 0);break}catch(g){y++;const t=g instanceof Error?g:new Error("Unknown error");y>=w?(N(t),l==null||l(t)):await new Promise(o=>setTimeout(o,i*Math.pow(2,y-1)))}p(!1),f(!1)},[a,s,h,i,l]),v=r.useCallback(async()=>{await c(!0)},[c]);return r.useEffect(()=>{c()},[c]),r.useEffect(()=>{if(b>0){const d=setInterval(()=>{c(!0)},b);return()=>clearInterval(d)}},[c,b]),r.useEffect(()=>{if(!m)return;const d=()=>{c(!0)};return window.addEventListener("focus",d),()=>window.removeEventListener("focus",d)},[c,m]),r.useEffect(()=>{if(!x)return;const d=()=>{c(!0)};return window.addEventListener("online",d),()=>window.removeEventListener("online",d)},[c,x]),{data:L,error:D,isLoading:E,isValidating:T,mutate:v}}function Q(){const{t:a}=O(),[s,j]=r.useState("loading"),{data:m}=J("homepage-analytics",()=>u.getHomepageAnalytics(),{retryCount:3,retryDelay:1e3,refreshInterval:3e4,onError:i=>console.warn("Analytics fetch failed:",i)});r.useEffect(()=>{(async()=>{try{const l=await u.getHealth();j(l!=null&&l.success?"online":"offline")}catch{j("offline")}})()},[]);const x=(m==null?void 0:m.data)||{totalRoutes:0,totalReports:0,averageScore:0,totalUsers:0},b=[{label:a("home.activeRoutes"),value:x.totalRoutes.toLocaleString(),icon:C},{label:a("home.reportsToday"),value:x.totalReports.toLocaleString(),icon:F},{label:a("home.safetyRating"),value:`${(x.averageScore||0).toFixed(1)}★`,icon:R},{label:a("home.activeUsers"),value:x.totalUsers.toLocaleString(),icon:W}],h=[{title:a("home.realTimeTracking"),description:a("home.realTimeTrackingDesc"),icon:$},{title:a("home.safetyReports"),description:a("home.safetyReportsDesc"),icon:R},{title:a("home.reliabilityScores"),description:a("home.reliabilityScoresDesc"),icon:q},{title:a("home.communityInsights"),description:a("home.communityInsightsDesc"),icon:W}];return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("section",{className:"hero",role:"banner",children:e.jsx("div",{className:"hero-content",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-gray-900 mb-6",children:a("home.title")}),e.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-3xl mx-auto",children:a("home.subtitle")}),e.jsxs("div",{className:"mb-8",role:"status","aria-live":"polite",children:[s==="loading"&&e.jsxs("div",{className:"inline-flex items-center px-4 py-2 rounded-full bg-yellow-100 text-yellow-800",children:[e.jsx("div",{className:"loading-spinner mr-2","aria-hidden":"true"}),a("home.checkingStatus")]}),s==="online"&&e.jsx("div",{className:"status-online",children:a("home.systemOnline")}),s==="offline"&&e.jsx("div",{className:"status-offline",children:a("home.systemOffline")})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(n,{to:"/map",className:"btn btn-primary btn-lg",children:[a("home.viewMap"),e.jsx(B,{className:"w-5 h-5 ml-2","aria-hidden":"true"})]}),e.jsx(n,{to:"/report",className:"btn btn-outline btn-lg",children:a("home.reportTrip")})]})]})})}),e.jsx("section",{className:"section bg-white","aria-labelledby":"stats-heading",children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{id:"stats-heading",className:"sr-only",children:"Platform Statistics"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:b.map(i=>{const l=i.icon;return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-primary-100 rounded-lg mb-4",children:e.jsx(l,{className:"w-6 h-6 text-primary-600","aria-hidden":"true"})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i.value}),e.jsx("div",{className:"text-sm text-gray-600",children:i.label})]},i.label)})})]})}),e.jsx("section",{className:"section bg-gray-50","aria-labelledby":"features-heading",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{id:"features-heading",className:"text-3xl font-bold text-gray-900 mb-4",children:a("home.howItWorks")}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:a("home.howItWorksDesc")})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:h.map(i=>{const l=i.icon;return e.jsx("article",{className:"card",children:e.jsxs("div",{className:"card-content text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-secondary-100 rounded-lg mb-4",children:e.jsx(l,{className:"w-6 h-6 text-secondary-600","aria-hidden":"true"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:i.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:i.description})]})},i.title)})})]})}),e.jsx("section",{className:"section bg-primary-600","aria-labelledby":"cta-heading",children:e.jsxs("div",{className:"container text-center",children:[e.jsx("h2",{id:"cta-heading",className:"text-3xl font-bold text-white mb-4",children:a("home.readyToStart")}),e.jsx("p",{className:"text-xl text-primary-100 mb-8 max-w-2xl mx-auto",children:a("home.readyToStartDesc")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(n,{to:"/signup",className:"btn btn-secondary btn-lg",children:a("home.signUpNow")}),e.jsx(n,{to:"/map",className:"btn btn-outline btn-lg text-white border-white hover:bg-white hover:text-primary-600",children:a("home.exploreMap")})]})]})})]})}function X(){var g;const{state:a}=_(),{t:s}=O(),[j,m]=r.useState(!0),[x,b]=r.useState(null),[h,i]=r.useState(null),[l,L]=r.useState(null),[S,D]=r.useState([]),[N,E]=r.useState([]),[p,T]=r.useState([]),[f]=r.useState(10),c=7,v=r.useCallback(async()=>{if(a.user){m(!0),b(null);try{const[t,o,k,I,A]=await Promise.all([u.getDashboardStats(),u.getWeatherData(),u.getRouteInsights({limit:f,days:c}),u.getFavoriteRoutes(a.user._id),u.getUserReports(a.user._id)]);t.success&&t.data&&i(t.data),o.success&&o.data&&L(o.data),k.success&&k.data&&D(k.data.insights),I.success&&I.data&&E(I.data.routes),A.success&&A.data&&T(A.data.reports.slice(0,5))}catch(t){console.error("Error loading dashboard data:",t),b("Failed to load dashboard data. Please try again.")}finally{m(!1)}}},[a.user,f]);r.useEffect(()=>{v()},[v]);const d=t=>{const o=t.toLowerCase();return o.includes("rain")?e.jsx(P,{className:"w-6 h-6 text-blue-500"}):o.includes("cloud")?e.jsx(M,{className:"w-6 h-6 text-gray-500"}):o.includes("sun")?e.jsx(G,{className:"w-6 h-6 text-yellow-500"}):e.jsx(M,{className:"w-6 h-6 text-gray-500"})},y=t=>{switch(t){case"low":return"text-green-600 bg-green-100";case"medium":return"text-yellow-600 bg-yellow-100";case"high":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},w=t=>t>=4?"text-green-600":t>=3?"text-yellow-600":"text-red-600";return j?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:s("dashboard.loadingYourDashboard")})]})}):x?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:s("dashboard.errorTitle")}),e.jsx("p",{className:"text-gray-600 mb-4",children:x}),e.jsx("button",{onClick:v,className:"btn btn-primary",children:s("dashboard.tryAgain")})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[s("dashboard.welcome"),", ",(g=a.user)==null?void 0:g.displayName,"!"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.headerSubtitle")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("en-KE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:new Date().toLocaleTimeString("en-KE",{hour:"2-digit",minute:"2-digit"})})]})]})})}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8",children:[l&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s("dashboard.currentWeather")}),d(l.condition)]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-2xl font-bold",children:[l.temperature,"°C"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsxs("span",{children:[l.humidity,"% ",s("dashboard.humidityLabel")]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsxs("span",{children:[l.windSpeed," ",s("dashboard.windSpeedLabel")]})]}),e.jsx("p",{className:"text-sm opacity-90",children:l.condition})]})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.activeRoutesTitle")}),e.jsx(C,{className:"w-6 h-6 text-primary-500"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-2",children:h.totalRoutes}),e.jsx("p",{className:"text-sm text-gray-600",children:s("dashboard.routesMonitored")})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.avgFareTitle")}),e.jsx(U,{className:"w-6 h-6 text-green-500"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900 mb-2",children:["KES ",h.averageFare]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("dashboard.currentAverage")})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.safetyRating")}),e.jsx(R,{className:"w-6 h-6 text-blue-500"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900 mb-2",children:[h.safetyRating.toFixed(1),"/5"]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("dashboard.overallSafety")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("dashboard.smartRouteInsights")}),e.jsx(n,{to:"/map",className:"btn btn-ghost btn-sm",children:s("dashboard.viewAllRoutesBtn")})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.aiRecommendations")})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4"}),S.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:s("dashboard.noInsights")}),e.jsx(n,{to:"/map",className:"btn btn-primary",children:s("dashboard.exploreRoutes")})]}):e.jsx("div",{className:"space-y-4",children:S.slice(0,5).map((t,o)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.routeName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s("dashboard.routeIdLabel"),": ",t.routeId]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("span",{className:`px-2 py-1 text-xs rounded-full ${y(t.crowdDensity.level)}`,children:[t.crowdDensity.level," ",s("dashboard.crowdSuffix")]})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-4 h-4 text-green-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:["KES ",t.farePrediction.predictedFare]}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.predictedFareLabel")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{className:`w-4 h-4 ${w(t.safetyScore.overallScore)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:`font-medium ${w(t.safetyScore.overallScore)}`,children:[t.safetyScore.overallScore.toFixed(1),"/5"]}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.safetyScoreLabel")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[t.travelTime," min"]}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.travelTimeLabel")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"w-4 h-4 text-purple-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.recommendedTime}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.bestTimeLabel")})]})]})]})]},o))})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.favoriteRoutes")})}),e.jsx("div",{className:"p-6",children:N.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(q,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:s("dashboard.noFavorites")}),e.jsx(n,{to:"/map",className:"btn btn-ghost btn-sm",children:s("dashboard.viewAllRoutesBtn")})]}):e.jsx("div",{className:"space-y-3",children:N.slice(0,3).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[s("dashboard.routeLabel")," ",t.routeNumber]}),e.jsx("div",{className:"text-sm text-gray-600",children:t.name})]}),e.jsx(n,{to:`/map?route=${t._id}`,className:"btn btn-ghost btn-sm",children:s("dashboard.viewLabel")})]},t._id))})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.recentReports")})}),e.jsx("div",{className:"p-6",children:p.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(F,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:s("dashboard.noReports")}),e.jsx(n,{to:"/report",className:"btn btn-ghost btn-sm",children:"Submit Report"})]}):e.jsx("div",{className:"space-y-3",children:p.slice(0,3).map(t=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:t.reportType}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.createdAt).toLocaleDateString()})]})]},t._id))})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.quickActions")})}),e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsxs(n,{to:"/map",className:"flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(C,{className:"w-5 h-5 text-primary-500"}),e.jsx("span",{className:"text-gray-900",children:s("dashboard.quickViewMap")})]}),e.jsxs(n,{to:"/report",className:"flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(F,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-gray-900",children:s("dashboard.quickSubmitReport")})]}),e.jsxs(n,{to:"/profile",className:"flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(z,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"text-gray-900",children:s("dashboard.quickViewProfile")})]})]})]})]})]})]})]})}function re(){const{state:a}=_();return a.isAuthenticated?e.jsx(X,{}):e.jsx(Q,{})}export{re as default};
//# sourceMappingURL=HomePage-D4bW-dAg.js.map
