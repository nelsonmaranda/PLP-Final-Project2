import{u as R,j as e,L as _,a as j}from"./index-BfH27FKw.js";import{r as a}from"./vendor-BKU87Gzz.js";import{b as T}from"./router-Z6rqMkFf.js";import{q as F,r as E}from"./icons-laTIaZ17.js";const v=["Super metro","Latema","Starbus","Embassava","Forward Travellers","ROG","Manchester","Zuri","MSL","Metro Trans","Lopha","Enabled","NNK","Double M","Risen","NMOA Compliant","City Shuttle","Citihoppa","Tram","Expresso","KMO","Buruburu"];function L(l){if(!l)return l;const r=new RegExp(`\\b(${v.map(d=>d.replace(/[-/\\^$*+?.()|[\]{}]/g,n=>n)).join("|")})\\b`,"i");return l.replace(r,"").replace(/\s{2,}/g," ").trim()}function K(){const l=T(),{t:r}=R(),[d,n]=a.useState([]),[y,f]=a.useState(!0),[x,h]=a.useState(!1),[b,u]=a.useState(null),[N,S]=a.useState(!1),[o,i]=a.useState({routeId:"",reportType:"delay",severity:"medium",isAnonymous:!1,description:"",location:{type:"Point",coordinates:[36.8219,-1.2921]}}),[g,w]=a.useState(""),[c,p]=a.useState("along_route"),[m,C]=a.useState("");a.useEffect(()=>{(async()=>{try{const s=await j.getRoutes({page:1,limit:200,sort:"name",order:"asc"});s.success&&s.data?n(s.data.routes):n([])}catch(s){console.error("Failed to load routes",s),n([])}finally{f(!1)}})()},[]);const k=async t=>{t.preventDefault(),h(!0),u(null);try{const s={...o,sacco:g||void 0,direction:c,fare:m?Number(m):void 0};(await j.createReport(s)).success?(S(!0),setTimeout(()=>l("/"),1200)):u("Failed to submit report")}catch(s){u(s.message||"Failed to submit report")}finally{h(!1)}};return y?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{}),e.jsx("p",{className:"text-gray-600 mt-4",children:r("report.loading")})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto bg-white shadow rounded-lg p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:r("report.title")}),b&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded border border-red-200",children:b}),N&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 text-green-700 rounded border border-green-200",children:"Report submitted successfully"}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.route")}),e.jsxs("select",{value:o.routeId,onChange:t=>i(s=>({...s,routeId:t.target.value})),className:"w-full border rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",children:r("report.selectRoute")}),d.map(t=>e.jsx("option",{value:t._id,children:L(t.name)},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.saccoOptional")}),e.jsxs("select",{value:g,onChange:t=>w(t.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:r("report.selectSacco")}),v.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.direction")}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("label",{className:"flex items-center space-x-2 border rounded px-3 py-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"direction",value:"from_cbd",checked:c==="from_cbd",onChange:()=>p("from_cbd")}),e.jsx("span",{children:r("report.fromCBD")})]}),e.jsxs("label",{className:"flex items-center space-x-2 border rounded px-3 py-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"direction",value:"to_cbd",checked:c==="to_cbd",onChange:()=>p("to_cbd")}),e.jsx("span",{children:r("report.toCBD")})]}),e.jsxs("label",{className:"flex items-center space-x-2 border rounded px-3 py-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"direction",value:"along_route",checked:c==="along_route",onChange:()=>p("along_route")}),e.jsx("span",{children:r("report.alongRoute")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.fare")}),e.jsx("input",{type:"number",min:"0",step:"1",value:m,onChange:t=>C(t.target.value),className:"w-full border rounded px-3 py-2",placeholder:r("report.farePlaceholder")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.reportType")}),e.jsxs("select",{value:o.reportType,onChange:t=>i(s=>({...s,reportType:t.target.value})),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"delay",children:r("report.delay")}),e.jsx("option",{value:"overcrowding",children:r("report.overcrowding")}),e.jsx("option",{value:"breakdown",children:r("report.breakdown")}),e.jsx("option",{value:"safety",children:r("report.safety")}),e.jsx("option",{value:"other",children:r("report.other")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.severity")}),e.jsxs("select",{value:o.severity,onChange:t=>i(s=>({...s,severity:t.target.value})),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"low",children:r("report.low")}),e.jsx("option",{value:"medium",children:r("report.medium")}),e.jsx("option",{value:"high",children:r("report.high")}),e.jsx("option",{value:"critical",children:r("report.critical")})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"anonymous",type:"checkbox",checked:o.isAnonymous,onChange:t=>i(s=>({...s,isAnonymous:t.target.checked}))}),e.jsx("label",{htmlFor:"anonymous",className:"text-sm text-gray-700",children:r("report.anonymous")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.description")}),e.jsx("textarea",{value:o.description,onChange:t=>i(s=>({...s,description:t.target.value})),className:"w-full border rounded px-3 py-2",rows:4,placeholder:r("report.descriptionPlaceholder")})]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",disabled:x,children:[x?e.jsx(F,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(E,{className:"w-4 h-4 mr-2"}),r("report.submit")]})]})]})})}export{K as default};
//# sourceMappingURL=ReportForm-BPEm321O.js.map
