import{u as L,b as _,j as e,a as d}from"./index-C3Iv6a33.js";import{r as o}from"./vendor-BKU87Gzz.js";import{L as F}from"./router-Z6rqMkFf.js";import{M as C,B as M,c as q,A as O,q as J,I as K,J as U,E as z,K as W,O as G}from"./icons-laTIaZ17.js";function Z(){var R;const{t:g}=L(),{state:k}=_(),v=((R=k.user)==null?void 0:R.role)==="admin",[S,n]=o.useState(!0),[u,m]=o.useState([]),[A,$]=o.useState(0),[T,j]=o.useState(!1),[h,N]=o.useState({name:"",description:""}),[f,y]=o.useState(!1),[w,x]=o.useState("");o.useEffect(()=>{const s=async()=>{try{n(!0);const a=await d.getRoutes({page:1,limit:100,sort:"createdAt",order:"desc"});a.success&&a.data?m(a.data.routes):m([])}catch(a){console.error("Failed to load routes",a),m([])}finally{n(!1)}},t=async()=>{var a;try{const r=await(await fetch("https://us-central1-smart-matwana-ke.cloudfunctions.net/api/reports/count")).json();r!=null&&r.success&&typeof((a=r==null?void 0:r.data)==null?void 0:a.count)=="number"&&$(r.data.count)}catch{}};s(),t()},[]);const B=async()=>{try{if(h.name.trim()){n(!0);const s=await d.createRoute({name:h.name,description:h.description});if(s.success&&s.data){const t=await d.getRoutes({page:1,limit:100,sort:"createdAt",order:"desc"});m(t.success&&t.data?t.data.routes:[]),N({name:"",description:""}),j(!1)}}}catch(s){console.error("Failed to add route",s)}finally{n(!1)}},D=async s=>{try{n(!0),await d.deleteRoute(s);const t=await d.getRoutes({page:1,limit:100,sort:"createdAt",order:"desc"});m(t.success&&t.data?t.data.routes:[])}catch(t){console.error("Failed to delete route",t)}finally{n(!1)}},E=async s=>{try{n(!0);const t=u.find(r=>r._id===s||r.id===s);if(!t)return;const a=t.status==="active"?"inactive":"active";await d.updateRoute(t._id||t.id,{status:a});const l=await d.getRoutes({page:1,limit:100,sort:"createdAt",order:"desc"});m(l.success&&l.data?l.data.routes:[])}catch(t){console.error("Failed to toggle route status",t)}finally{n(!1)}},I=[{title:"Total Routes",value:u.length,icon:C,color:"text-blue-600",bgColor:"bg-blue-100"},{title:"Active Routes",value:u.length,icon:M,color:"text-green-600",bgColor:"bg-green-100"},{title:"Total Reports",value:A,icon:q,color:"text-purple-600",bgColor:"bg-purple-100"},{title:"Safety Issues",value:u.reduce((s,t)=>s+(t.safetyIssues||0),0),icon:O,color:"text-red-600",bgColor:"bg-red-100"}],P=async()=>{var s;y(!0),x("");try{let t=[];try{const c=await fetch("/scripts/seed-routes.json");c.ok&&(t=await c.json())}catch{}(!t||t.length===0)&&(t=[{name:"Route 46 - CBD to Westlands",routeNumber:"46"},{name:"Route 44 - CBD to Kasarani",routeNumber:"44"},{name:"Route 58 - CBD to Embakasi",routeNumber:"58"}]);const a=localStorage.getItem("authToken");if(!a){x("Missing auth token. Please login again."),y(!1);return}let l=0;for(let c=0;c<t.length;c+=10){const b=t.slice(c,c+10),i=await(await fetch("https://us-central1-smart-matwana-ke.cloudfunctions.net/api/admin/seed/routes",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({routes:b})})).json();i!=null&&i.success&&((s=i==null?void 0:i.data)==null?void 0:s.created)>=0?(l+=i.data.created,x(p=>`${p}
Chunk ${c}-${c+b.length-1}: created ${i.data.created}`)):x(p=>`${p}
Chunk ${c}-${c+b.length-1}: failed (${(i==null?void 0:i.message)||"unknown"})`),await new Promise(p=>setTimeout(p,250))}const r=await d.getRoutes({page:1,limit:100,sort:"createdAt",order:"desc"});m(r.success&&r.data?r.data.routes:[]),x(c=>`${c}
Total created: ${l}`)}catch(t){x(`Seed failed: ${(t==null?void 0:t.message)||t}`)}finally{y(!1)}};return S?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"loading-spinner mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:g("admin.loading")})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container py-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:g("admin.title")}),e.jsx("p",{className:"text-gray-600 mt-2",children:g("admin.subtitle")})]}),v&&e.jsxs("div",{className:"card mb-6",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"card-title",children:"Seed Curated CBD Routes"}),e.jsxs("button",{onClick:P,disabled:f,className:"btn btn-primary btn-sm",children:[f?e.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(K,{className:"w-4 h-4 mr-2"}),f?"Seedingâ€¦":"Run Seed"]})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Seeds about 50 CBD routes in small chunks. Requires admin login."}),w&&e.jsx("pre",{className:"mt-3 whitespace-pre-wrap text-xs bg-gray-50 p-3 rounded border border-gray-200",children:w})]})]}),v&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:e.jsx(F,{to:"/admin/routes",className:"card hover:bg-gray-50",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-indigo-100",children:e.jsx(C,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Tools"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"Route Editor"})]})]})})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:I.map((s,t)=>{const a=s.icon;return e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-3 rounded-lg ${s.bgColor}`,children:e.jsx(a,{className:`w-6 h-6 ${s.color}`})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.value})]})]})})},t)})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"card-title",children:"Route Management"}),e.jsxs("button",{onClick:()=>j(!0),className:"btn btn-primary btn-sm",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Add Route"]})]})}),e.jsxs("div",{className:"card-content p-0",children:[T&&e.jsxs("div",{className:"border-b border-gray-200 p-6 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add New Route"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Route Name"}),e.jsx("input",{type:"text",value:h.name,onChange:s=>N(t=>({...t,name:s.target.value})),className:"form-input",placeholder:"e.g., Route 42 - Thika Road"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("input",{type:"text",value:h.description,onChange:s=>N(t=>({...t,description:s.target.value})),className:"form-input",placeholder:"Route description"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>j(!1),className:"btn btn-outline",children:"Cancel"}),e.jsx("button",{onClick:B,className:"btn btn-primary",children:"Add Route"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Route"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reliability"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Safety"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reports"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(s=>{var t,a,l,r;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-gray-900",children:((t=s.score)==null?void 0:t.reliability)??"-"}),e.jsx("div",{className:"ml-2 w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${(((a=s.score)==null?void 0:a.reliability)??0)/5*100}%`}})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-gray-900",children:((l=s.score)==null?void 0:l.safety)??"-"}),e.jsx("div",{className:"ml-2 w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${(((r=s.score)==null?void 0:r.safety)??0)/5*100}%`}})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.reportsCount??0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(s.status||"active")==="active"?"bg-green-100 text-green-800":(s.status||"inactive")==="maintenance"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.status||"active"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-900",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-gray-600 hover:text-gray-900",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>E(s._id||s.id),className:"text-green-600 hover:text-green-900",children:(s.status||"active")==="active"?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>D(s._id||s.id),className:"text-red-600 hover:text-red-900",children:e.jsx(G,{className:"w-4 h-4"})})]})})]},s._id||s.id)})})]})})]})]})]})})}export{Z as default};
//# sourceMappingURL=Admin-DahEEeKt.js.map
