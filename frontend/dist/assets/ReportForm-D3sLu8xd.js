import{u as T,j as e,L as A,a as v}from"./index-BBcuCBxx.js";import{r as o}from"./vendor-BKU87Gzz.js";import{b as F}from"./router-BF-yxxER.js";import{r as E,s as L}from"./icons-l6XdvyrE.js";const f=["Super metro","Latema","Starbus","Embassava","Forward Travellers","ROG","Manchester","Zuri","MSL","Metro Trans","Lopha","Enabled","NNK","Double M","Risen","NMOA Compliant","City Shuttle","Citihoppa","Tram","Expresso","KMO","Buruburu"];function D(l){if(!l)return l;const r=new RegExp(`\\b(${f.map(m=>m.replace(/[-/\\^$*+?.()|[\]{}]/g,n=>n)).join("|")})\\b`,"i");return l.replace(r,"").replace(/\s{2,}/g," ").trim()}function P(){const l=F(),{t:r}=T(),[m,n]=o.useState([]),[N,S]=o.useState(!0),[g,p]=o.useState(!1),[j,d]=o.useState(null),[w,C]=o.useState(!1),[a,c]=o.useState({routeId:"",reportType:"delay",severity:"medium",isAnonymous:!1,description:"",location:{type:"Point",coordinates:[36.8219,-1.2921]}}),[i,k]=o.useState(""),[x,y]=o.useState(""),[u,h]=o.useState("along_route"),[b,R]=o.useState("");o.useEffect(()=>{(async()=>{try{const s=await v.getRoutes({page:1,limit:200,sort:"name",order:"asc"});s.success&&s.data?n(s.data.routes):n([])}catch(s){console.error("Failed to load routes",s),n([])}finally{S(!1)}})()},[]);const _=async t=>{if(t.preventDefault(),p(!0),d(null),i==="other"&&!x.trim()){d(r("report.otherSaccoRequired")),p(!1);return}try{const s={...a,sacco:i==="other"?x.trim():i||void 0,direction:u,fare:b?Number(b):void 0,isAnonymous:!!a.isAnonymous};(await v.createReport(s)).success?(C(!0),setTimeout(()=>l("/"),1200)):d("Failed to submit report")}catch(s){d(s.message||"Failed to submit report")}finally{p(!1)}};return N?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(A,{}),e.jsx("p",{className:"text-gray-600 mt-4",children:r("report.loading")})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto bg-white shadow rounded-lg p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:r("report.title")}),j&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded border border-red-200",children:j}),w&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 text-green-700 rounded border border-green-200",children:"Report submitted successfully"}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.route")}),e.jsxs("select",{value:a.routeId,onChange:t=>c(s=>({...s,routeId:t.target.value})),className:"w-full border rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",children:r("report.selectRoute")}),m.map(t=>e.jsx("option",{value:t._id,children:D(t.name)},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.saccoOptional")}),e.jsxs("select",{value:i,onChange:t=>{k(t.target.value),t.target.value!=="other"&&y("")},className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:r("report.selectSacco")}),f.map(t=>e.jsx("option",{value:t,children:t},t)),e.jsx("option",{value:"other",children:r("report.otherSacco")})]}),i==="other"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.specifyOtherSacco")}),e.jsx("input",{type:"text",value:x,onChange:t=>y(t.target.value),placeholder:r("report.otherSaccoPlaceholder"),className:"w-full border rounded px-3 py-2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.direction")}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("label",{className:"flex items-center space-x-2 border rounded px-3 py-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"direction",value:"from_cbd",checked:u==="from_cbd",onChange:()=>h("from_cbd")}),e.jsx("span",{children:r("report.fromCBD")})]}),e.jsxs("label",{className:"flex items-center space-x-2 border rounded px-3 py-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"direction",value:"to_cbd",checked:u==="to_cbd",onChange:()=>h("to_cbd")}),e.jsx("span",{children:r("report.toCBD")})]}),e.jsxs("label",{className:"flex items-center space-x-2 border rounded px-3 py-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"direction",value:"along_route",checked:u==="along_route",onChange:()=>h("along_route")}),e.jsx("span",{children:r("report.alongRoute")})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.fare")}),e.jsx("input",{type:"number",min:"0",step:"1",value:b,onChange:t=>R(t.target.value),className:"w-full border rounded px-3 py-2",placeholder:r("report.farePlaceholder")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.reportType")}),e.jsxs("select",{value:a.reportType,onChange:t=>c(s=>({...s,reportType:t.target.value})),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"delay",children:r("report.delay")}),e.jsx("option",{value:"overcrowding",children:r("report.overcrowding")}),e.jsx("option",{value:"breakdown",children:r("report.breakdown")}),e.jsx("option",{value:"safety",children:r("report.safety")}),e.jsx("option",{value:"other",children:r("report.other")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.severity")}),e.jsxs("select",{value:a.severity,onChange:t=>c(s=>({...s,severity:t.target.value})),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"low",children:r("report.low")}),e.jsx("option",{value:"medium",children:r("report.medium")}),e.jsx("option",{value:"high",children:r("report.high")}),e.jsx("option",{value:"critical",children:r("report.critical")})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"anonymous",type:"checkbox",checked:a.isAnonymous,onChange:t=>c(s=>({...s,isAnonymous:t.target.checked}))}),e.jsx("label",{htmlFor:"anonymous",className:"text-sm text-gray-700",children:r("report.anonymous")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:r("report.description")}),e.jsx("textarea",{value:a.description,onChange:t=>c(s=>({...s,description:t.target.value})),className:"w-full border rounded px-3 py-2",rows:4,placeholder:r("report.descriptionPlaceholder")})]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",disabled:g,children:[g?e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(L,{className:"w-4 h-4 mr-2"}),r("report.submit")]})]})]})})}export{P as default};
//# sourceMappingURL=ReportForm-D3sLu8xd.js.map
