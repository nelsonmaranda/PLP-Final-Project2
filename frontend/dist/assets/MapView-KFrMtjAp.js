var J=Object.defineProperty;var Q=(a,t,i)=>t in a?J(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i;var U=(a,t,i)=>Q(a,typeof t!="symbol"?t+"":t,i);import{a as B,j as e,L as G}from"./index-CVZpsdp2.js";import{r as l}from"./vendor-BKU87Gzz.js";import{M as W,T as X,P as Y,a as Z,b as ee,L as T}from"./leaflet-DyOFlehG.js";import{o as se,F as z,p as ae,l as P,g as V,c as I,M as re}from"./icons-B_aqzpWL.js";import"./router-Z6rqMkFf.js";class te{constructor(){U(this,"cache",new Map)}set(t,i,w){const o=Date.now();this.cache.set(t,{data:i,timestamp:o,expiresAt:o+w})}get(t){const i=this.cache.get(t);return i?Date.now()>i.expiresAt?(this.cache.delete(t),null):i.data:null}clear(){this.cache.clear()}delete(t){this.cache.delete(t)}}const H=new te;function ie(a,t=[],i={}){const{debounceMs:w=300,cacheTime:o=5*60*1e3,retryAttempts:E=3,retryDelay:n=1e3}=i,[p,M]=l.useState(null),[D,d]=l.useState(!1),[K,j]=l.useState(null),[k,f]=l.useState(0),N=l.useRef(),x=l.useRef(),g=JSON.stringify(t),u=l.useCallback(async($=!1)=>{const S=H.get(g);if(S&&!$){M(S);return}x.current&&x.current.abort(),x.current=new AbortController;try{d(!0),j(null);const b=await a();H.set(g,b,o),M(b),f(0)}catch(b){const s=b;if(s.name==="AbortError")return;j(s),k<E&&(f(r=>r+1),setTimeout(()=>{u(!0)},n*Math.pow(2,k)))}finally{d(!1)}},[a,g,o,E,n,k]),A=l.useCallback(()=>{N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{u()},w)},[u,w]);l.useEffect(()=>(A(),()=>{N.current&&clearTimeout(N.current),x.current&&x.current.abort()}),[A]);const L=l.useCallback(()=>{H.delete(g),u()},[g,u]),_=l.useCallback(()=>{H.clear()},[]);return{data:p,loading:D,error:K,retryCount:k,refetch:L,clearCache:_}}const q=T.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});typeof T<"u"&&T.Marker&&(T.Marker.prototype.options.icon=q);function me(){var g,u,A,L,_,$,S,b;const[a,t]=l.useState(null),[i,w]=l.useState(!1),[o,E]=l.useState(!1),[n,p]=l.useState({highReliability:!0,safeRoutes:!0,lowFare:!1}),M=[-1.2921,36.8219],D=l.useCallback(async()=>{const s=await B.getRoutes({page:1,limit:50,sort:"createdAt",order:"desc"});return s.success&&s.data?s.data.routes:[]},[]),{data:d,loading:K,error:j,refetch:k}=ie(D,[n],{debounceMs:500,cacheTime:2*60*1e3,retryAttempts:2}),f=(()=>{try{return(d||[]).filter(s=>!(n.highReliability&&(!s.score||typeof s.score.reliability!="number"||s.score.reliability<4)||n.safeRoutes&&(!s.score||typeof s.score.safety!="number"||s.score.safety<4)||n.lowFare&&(typeof s.fare!="number"||s.fare>=50)))}catch(s){return console.error("Error filtering routes:",s),d||[]}})(),N=s=>s>=4.5?"#22c55e":s>=3.5?"#f59e0b":s>=2.5?"#f97316":"#ef4444",x=s=>s.score?N(s.score.overall):"#3b82f6";return K?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading routes..."})]})}):j?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:(j==null?void 0:j.message)||"An error occurred"}),e.jsx("button",{onClick:k,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Try Again"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"container py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"card-title",children:"Nairobi Matatu Routes"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:`btn btn-sm ${i?"btn-primary":"btn-outline"}`,onClick:()=>w(!i),"aria-label":"Toggle filter panel","aria-pressed":i,children:[e.jsx(z,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filter"]}),e.jsxs("button",{className:`btn btn-sm ${o?"btn-primary":"btn-outline"}`,onClick:()=>E(!o),"aria-label":"Toggle list view","aria-pressed":o,children:[e.jsx(ae,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"List"]})]})]})}),e.jsxs("div",{className:"card-content p-0",children:[i&&e.jsx("div",{className:"p-4 bg-gray-50 border-b",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4 text-gray-500","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Quick Filters"})]}),e.jsxs("fieldset",{className:"flex flex-wrap gap-4",children:[e.jsx("legend",{className:"sr-only",children:"Route filters"}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:n.highReliability,onChange:s=>p(r=>({...r,highReliability:s.target.checked}))}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"High Reliability (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:n.safeRoutes,onChange:s=>p(r=>({...r,safeRoutes:s.target.checked}))}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Safe Routes (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:n.lowFare,onChange:s=>p(r=>({...r,lowFare:s.target.checked}))}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Low Fare (Under 50 KES)"})]})]})]})}),o?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:[f.length," of ",(d==null?void 0:d.length)||0," routes"]}),f.map(s=>{var r,c;return e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${(a==null?void 0:a._id)===s._id?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>t(s),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.operator," - Route ",s.routeNumber]}),e.jsxs("div",{className:"flex items-center mt-2 space-x-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"w-3 h-3 text-yellow-500 mr-1"}),e.jsx("span",{children:((c=(r=s.score)==null?void 0:r.overall)==null?void 0:c.toFixed(1))||"N/A"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-3 h-3 text-blue-500 mr-1"}),e.jsxs("span",{children:[s.operatingHours.start," - ",s.operatingHours.end]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["KES ",s.fare]}),e.jsx("div",{className:"w-4 h-4 rounded-full mt-1 ml-auto",style:{backgroundColor:x(s)}})]})]})},s._id)})]})}):e.jsx("div",{className:"map-container h-96",role:"img","aria-label":"Interactive map showing Nairobi matatu routes",children:e.jsxs(W,{center:M,zoom:11,style:{height:"100%",width:"100%"},children:[e.jsx(X,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),f.map(s=>{try{const r=[];if(s.path&&Array.isArray(s.path)&&s.path.length>0){for(let c=0;c<s.path.length;c+=2)if(c+1<s.path.length){const y=s.path[c+1],m=s.path[c];typeof y=="number"&&typeof m=="number"&&!isNaN(y)&&!isNaN(m)&&r.push([y,m])}}return e.jsxs("div",{children:[r.length>0&&e.jsx(Y,{positions:r,color:x(s),weight:(a==null?void 0:a._id)===s._id?6:4,opacity:(a==null?void 0:a._id)===s._id?.8:.6}),s.stops&&Array.isArray(s.stops)&&s.stops.map((c,y)=>{var m,C,F,R;try{const h=c.coordinates;if(!h||!Array.isArray(h)||h.length!==2)return null;const[v,O]=h;return typeof v!="number"||typeof O!="number"||isNaN(v)||isNaN(O)?null:e.jsx(Z,{position:[v,O],icon:q,children:e.jsx(ee,{children:e.jsxs("div",{className:"p-2",children:[e.jsx("h3",{className:"font-semibold",children:c.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.operator}),e.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-3 w-3 mr-1 text-yellow-400"}),((C=(m=s.score)==null?void 0:m.overall)==null?void 0:C.toFixed(1))||"N/A"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),((R=(F=s.score)==null?void 0:F.safety)==null?void 0:R.toFixed(1))||"N/A"]}),e.jsxs("div",{className:"text-gray-600",children:[s.fare," KES"]})]})]})})},y)}catch(h){return console.error("Error rendering stop:",h),null}})]},s._id)}catch(r){return console.error("Error rendering route:",r),null}})]})})]})]})}),e.jsxs("div",{className:"w-full lg:w-80",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Available Routes"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[f.length," of ",(d==null?void 0:d.length)||0," routes"]})]}),e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4 text-gray-500","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filters"})]}),e.jsxs("fieldset",{className:"space-y-2",children:[e.jsx("legend",{className:"sr-only",children:"Route filters"}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:n.highReliability,onChange:s=>p(r=>({...r,highReliability:s.target.checked})),"aria-describedby":"high-reliability-desc"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"High Reliability (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:n.safeRoutes,onChange:s=>p(r=>({...r,safeRoutes:s.target.checked})),"aria-describedby":"safe-routes-desc"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Safe Routes (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:n.lowFare,onChange:s=>p(r=>({...r,lowFare:s.target.checked})),"aria-describedby":"low-fare-desc"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Low Fare (Under 50 KES)"})]})]})]})}),e.jsx("div",{className:"card-content p-0",children:e.jsx("div",{className:"divide-y divide-gray-200",children:f.map(s=>{var r,c,y,m,C,F,R,h;return e.jsx("div",{className:`p-4 cursor-pointer hover:bg-gray-50 transition-colors ${(a==null?void 0:a._id)===s._id?"bg-primary-50 border-r-4 border-primary-500":""}`,onClick:()=>t(s),role:"button",tabIndex:0,onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),t(s))},"aria-label":`Select route ${s.name} by ${s.operator}`,"aria-pressed":(a==null?void 0:a._id)===s._id,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.operator}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"w-4 h-4 text-yellow-500 mr-1","aria-hidden":"true"}),e.jsx("span",{"aria-label":`Overall rating: ${((c=(r=s.score)==null?void 0:r.overall)==null?void 0:c.toFixed(1))||"N/A"} stars`,children:((m=(y=s.score)==null?void 0:y.overall)==null?void 0:m.toFixed(1))||"N/A"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-blue-500 mr-1","aria-hidden":"true"}),e.jsxs("span",{"aria-label":`Operating hours: ${s.operatingHours.start} to ${s.operatingHours.end}`,children:[s.operatingHours.start," - ",s.operatingHours.end]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"w-4 h-4 text-green-500 mr-1","aria-hidden":"true"}),e.jsx("span",{"aria-label":`Safety rating: ${((F=(C=s.score)==null?void 0:C.safety)==null?void 0:F.toFixed(1))||"N/A"} stars`,children:((h=(R=s.score)==null?void 0:R.safety)==null?void 0:h.toFixed(1))||"N/A"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["KES ",s.fare]}),e.jsx("div",{className:"w-4 h-4 rounded-full mt-1",style:{backgroundColor:x(s)},"aria-label":`Route quality indicator: ${x(s)}`})]})]})},s._id)})})})]}),a&&e.jsxs("div",{className:"card mt-4",role:"region","aria-labelledby":"route-details-heading",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{id:"route-details-heading",className:"text-lg font-semibold",children:"Route Details"})}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.operator}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Real-time updates available"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600","aria-label":`Reliability score: ${((u=(g=a.score)==null?void 0:g.reliability)==null?void 0:u.toFixed(1))||"N/A"} out of 5`,children:((L=(A=a.score)==null?void 0:A.reliability)==null?void 0:L.toFixed(1))||"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Reliability"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-secondary-600","aria-label":`Safety score: ${(($=(_=a.score)==null?void 0:_.safety)==null?void 0:$.toFixed(1))||"N/A"} out of 5`,children:((b=(S=a.score)==null?void 0:S.safety)==null?void 0:b.toFixed(1))||"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Safety"})]})]}),e.jsxs("dl",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Fare:"}),e.jsxs("dd",{className:"font-medium",children:["KES ",a.fare]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Operating Hours:"}),e.jsxs("dd",{className:"font-medium",children:[a.operatingHours.start," - ",a.operatingHours.end]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Stops:"}),e.jsxs("dd",{className:"font-medium",children:[a.stops.length," stops"]})]})]}),e.jsxs("button",{className:"btn btn-primary w-full","aria-label":"View selected route on map",children:[e.jsx(re,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"View on Map"]})]})})]})]})]})})})}export{me as default};
//# sourceMappingURL=MapView-KFrMtjAp.js.map
