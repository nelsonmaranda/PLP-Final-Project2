import{u as U,j as e,a as p,b as B}from"./index-BBcuCBxx.js";import{r}from"./vendor-BKU87Gzz.js";import{L as c}from"./router-BF-yxxER.js";import{M as F,B as W,g as D,d as M,h as O,l as _,m as q,A as K,n as V,D as H,W as Z,T as $,N as Y,o as z,E as G,C as P,Z as J}from"./icons-l6XdvyrE.js";function Q(t,s,d={}){const{revalidateOnFocus:m=!0,revalidateOnReconnect:x=!0,refreshInterval:u=0,retryCount:h=3,retryDelay:i=1e3,onError:l}=d,[E,L]=r.useState(void 0),[T,N]=r.useState(void 0),[C,v]=r.useState(!1),[I,f]=r.useState(!1),n=r.useCallback(async(o=!1)=>{o||v(!0),f(!0),N(void 0);let y=0;const k=h+1;for(;y<k;)try{const j=await s();L(j),N(void 0);break}catch(j){y++;const w=j instanceof Error?j:new Error("Unknown error");y>=k?(N(w),l==null||l(w)):await new Promise(a=>setTimeout(a,i*Math.pow(2,y-1)))}v(!1),f(!1)},[t,s,h,i,l]),g=r.useCallback(async()=>{await n(!0)},[n]);return r.useEffect(()=>{n()},[n]),r.useEffect(()=>{if(u>0){const o=setInterval(()=>{n(!0)},u);return()=>clearInterval(o)}},[n,u]),r.useEffect(()=>{if(!m)return;const o=()=>{n(!0)};return window.addEventListener("focus",o),()=>window.removeEventListener("focus",o)},[n,m]),r.useEffect(()=>{if(!x)return;const o=()=>{n(!0)};return window.addEventListener("online",o),()=>window.removeEventListener("online",o)},[n,x]),{data:E,error:T,isLoading:C,isValidating:I,mutate:g}}function X(){const{t}=U(),[s,d]=r.useState("loading"),{data:m}=Q("homepage-analytics",()=>p.getHomepageAnalytics(),{retryCount:3,retryDelay:1e3,refreshInterval:3e4,onError:i=>console.warn("Analytics fetch failed:",i)});r.useEffect(()=>{(async()=>{try{const l=await p.getHealth();d(l!=null&&l.success?"online":"offline")}catch{d("offline")}})()},[]);const x=(m==null?void 0:m.data)||{totalRoutes:0,totalReports:0,averageScore:0,totalUsers:0},u=[{label:t("home.activeRoutes"),value:x.totalRoutes.toLocaleString(),icon:F},{label:t("home.reportsToday"),value:x.totalReports.toLocaleString(),icon:W},{label:t("home.safetyRating"),value:`${(x.averageScore||0).toFixed(1)}â˜…`,icon:D},{label:t("home.activeUsers"),value:x.totalUsers.toLocaleString(),icon:M}],h=[{title:t("home.realTimeTracking"),description:t("home.realTimeTrackingDesc"),icon:O},{title:t("home.safetyReports"),description:t("home.safetyReportsDesc"),icon:D},{title:t("home.reliabilityScores"),description:t("home.reliabilityScoresDesc"),icon:_},{title:t("home.communityInsights"),description:t("home.communityInsightsDesc"),icon:M}];return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("section",{className:"hero",role:"banner",children:e.jsx("div",{className:"hero-content",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-gray-900 mb-6",children:t("home.title")}),e.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-3xl mx-auto",children:t("home.subtitle")}),e.jsxs("div",{className:"mb-8",role:"status","aria-live":"polite",children:[s==="loading"&&e.jsxs("div",{className:"inline-flex items-center px-4 py-2 rounded-full bg-yellow-100 text-yellow-800",children:[e.jsx("div",{className:"loading-spinner mr-2","aria-hidden":"true"}),t("home.checkingStatus")]}),s==="online"&&e.jsx("div",{className:"status-online",children:t("home.systemOnline")}),s==="offline"&&e.jsx("div",{className:"status-offline",children:t("home.systemOffline")})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(c,{to:"/map",className:"btn btn-primary btn-lg",children:[t("home.viewMap"),e.jsx(q,{className:"w-5 h-5 ml-2","aria-hidden":"true"})]}),e.jsx(c,{to:"/report",className:"btn btn-outline btn-lg",children:t("home.reportTrip")})]})]})})}),e.jsx("section",{className:"section bg-white","aria-labelledby":"stats-heading",children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{id:"stats-heading",className:"sr-only",children:"Platform Statistics"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:u.map(i=>{const l=i.icon;return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-primary-100 rounded-lg mb-4",children:e.jsx(l,{className:"w-6 h-6 text-primary-600","aria-hidden":"true"})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i.value}),e.jsx("div",{className:"text-sm text-gray-600",children:i.label})]},i.label)})})]})}),e.jsx("section",{className:"section bg-gray-50","aria-labelledby":"features-heading",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{id:"features-heading",className:"text-3xl font-bold text-gray-900 mb-4",children:t("home.howItWorks")}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:t("home.howItWorksDesc")})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:h.map(i=>{const l=i.icon;return e.jsx("article",{className:"card",children:e.jsxs("div",{className:"card-content text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-secondary-100 rounded-lg mb-4",children:e.jsx(l,{className:"w-6 h-6 text-secondary-600","aria-hidden":"true"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:i.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:i.description})]})},i.title)})})]})}),e.jsx("section",{className:"section bg-primary-600","aria-labelledby":"cta-heading",children:e.jsxs("div",{className:"container text-center",children:[e.jsx("h2",{id:"cta-heading",className:"text-3xl font-bold text-white mb-4",children:t("home.readyToStart")}),e.jsx("p",{className:"text-xl text-primary-100 mb-8 max-w-2xl mx-auto",children:t("home.readyToStartDesc")}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(c,{to:"/signup",className:"btn btn-secondary btn-lg",children:t("home.signUpNow")}),e.jsx(c,{to:"/map",className:"btn btn-outline btn-lg text-white border-white hover:bg-white hover:text-primary-600",children:t("home.exploreMap")})]})]})})]})}function ee(){var w;const{state:t}=B(),{t:s}=U(),[d,m]=r.useState(!0),[x,u]=r.useState(null),[h,i]=r.useState(null),[l,E]=r.useState(null),[L,T]=r.useState([]),[N,C]=r.useState([]),[v,I]=r.useState([]),[f]=r.useState(10),n=7,g=r.useCallback(async()=>{if(t.user){m(!0),u(null);try{const[a,b,A,S,R]=await Promise.all([p.getDashboardStats(),p.getWeatherData(),p.getRouteInsights({limit:f,days:n}),p.getFavoriteRoutes(t.user._id),p.getUserReports(t.user._id)]);a.success&&a.data&&i(a.data),b.success&&b.data&&E(b.data),A.success&&A.data&&T(A.data.insights),S.success&&S.data?(console.log("Favorite routes loaded:",S.data.routes),C(S.data.routes)):console.log("Failed to load favorite routes:",S),R.success&&R.data?(console.log("Recent reports loaded:",R.data.reports),I(R.data.reports.slice(0,5))):console.log("Failed to load recent reports:",R)}catch(a){console.error("Error loading dashboard data:",a),u("Failed to load dashboard data. Please try again.")}finally{m(!1)}}},[t.user,f]);r.useEffect(()=>{g()},[g]);const o=a=>{const b=a.toLowerCase();return b.includes("rain")?e.jsx(H,{className:"w-6 h-6 text-blue-500"}):b.includes("cloud")?e.jsx(P,{className:"w-6 h-6 text-gray-500"}):b.includes("sun")?e.jsx(J,{className:"w-6 h-6 text-yellow-500"}):e.jsx(P,{className:"w-6 h-6 text-gray-500"})},y=a=>{switch(a){case"low":return"text-green-600 bg-green-100";case"medium":return"text-yellow-600 bg-yellow-100";case"high":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},k=a=>{switch(a){case"low":return s("dashboard.crowdLow");case"medium":return s("dashboard.crowdMedium");case"high":return s("dashboard.crowdHigh");default:return`${a} ${s("dashboard.crowdSuffix")}`}},j=a=>a>=4?"text-green-600":a>=3?"text-yellow-600":"text-red-600";return d?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:s("dashboard.loadingYourDashboard")})]})}):x?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:s("dashboard.errorTitle")}),e.jsx("p",{className:"text-gray-600 mb-4",children:x}),e.jsx("button",{onClick:g,className:"btn btn-primary",children:s("dashboard.tryAgain")})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[s("dashboard.welcome"),", ",(w=t.user)==null?void 0:w.displayName,"!"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.headerSubtitle")})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("en-KE",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:new Date().toLocaleTimeString("en-KE",{hour:"2-digit",minute:"2-digit"})})]})]})})}),e.jsxs("div",{className:"px-6 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8",children:[l&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s("dashboard.currentWeather")}),o(l.condition)]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-2xl font-bold",children:[l.temperature,"Â°C"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsxs("span",{children:[l.humidity,"% ",s("dashboard.humidityLabel")]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsxs("span",{children:[l.windSpeed," ",s("dashboard.windSpeedLabel")]})]}),e.jsx("p",{className:"text-sm opacity-90",children:l.condition})]})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.activeRoutesTitle")}),e.jsx(F,{className:"w-6 h-6 text-primary-500"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900 mb-2",children:h.totalRoutes}),e.jsx("p",{className:"text-sm text-gray-600",children:s("dashboard.routesMonitored")})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.avgFareTitle")}),e.jsx($,{className:"w-6 h-6 text-green-500"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900 mb-2",children:["KES ",h.averageFare]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("dashboard.currentAverage")})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.safetyRating")}),e.jsx(D,{className:"w-6 h-6 text-blue-500"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900 mb-2",children:[h.safetyRating.toFixed(1),"/5"]}),e.jsx("p",{className:"text-sm text-gray-600",children:s("dashboard.overallSafety")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s("dashboard.smartRouteInsights")}),e.jsx(c,{to:"/map",className:"btn btn-ghost btn-sm",children:s("dashboard.viewAllRoutesBtn")})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("dashboard.aiRecommendations")})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4"}),L.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:s("dashboard.noInsights")}),e.jsx(c,{to:"/map",className:"btn btn-primary",children:s("dashboard.exploreRoutes")})]}):e.jsx("div",{className:"space-y-4",children:L.slice(0,5).map((a,b)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a.routeName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s("dashboard.routeIdLabel"),": ",a.routeId]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${y(a.crowdDensity.level)}`,children:k(a.crowdDensity.level)})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"w-4 h-4 text-green-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:["KES ",a.farePrediction.predictedFare]}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.predictedFareLabel")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:`w-4 h-4 ${j(a.safetyScore.overallScore)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:`font-medium ${j(a.safetyScore.overallScore)}`,children:[a.safetyScore.overallScore.toFixed(1),"/5"]}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.safetyScoreLabel")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[a.travelTime," min"]}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.travelTimeLabel")})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-4 h-4 text-purple-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:a.recommendedTime}),e.jsx("div",{className:"text-xs text-gray-500",children:s("dashboard.bestTimeLabel")})]})]})]})]},b))})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.favoriteRoutes")}),e.jsxs("button",{onClick:g,disabled:d,className:"flex items-center space-x-1 px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 disabled:opacity-50",children:[e.jsx("svg",{className:`w-3 h-3 ${d?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:s("dashboard.refresh")})]})]})}),e.jsx("div",{className:"p-6",children:d?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:s("dashboard.loading")})]}):N.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(_,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:s("dashboard.noFavorites")}),e.jsx(c,{to:"/map",className:"btn btn-ghost btn-sm",children:s("dashboard.viewAllRoutesBtn")})]}):e.jsx("div",{className:"space-y-3",children:N.slice(0,3).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[s("dashboard.routeLabel")," ",a.routeNumber]}),e.jsx("div",{className:"text-sm text-gray-600",children:a.name})]}),e.jsx(c,{to:`/map?route=${a._id}`,className:"btn btn-ghost btn-sm",children:s("dashboard.viewLabel")})]},a._id))})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.recentReports")}),e.jsxs("button",{onClick:g,disabled:d,className:"flex items-center space-x-1 px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 disabled:opacity-50",children:[e.jsx("svg",{className:`w-3 h-3 ${d?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:s("dashboard.refresh")})]})]})}),e.jsx("div",{className:"p-6",children:d?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:s("dashboard.loading")})]}):v.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(W,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:s("dashboard.noReports")}),e.jsx(c,{to:"/report",className:"btn btn-ghost btn-sm",children:s("dashboard.submitReportBtn")})]}):e.jsx("div",{className:"space-y-3",children:v.slice(0,3).map(a=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-500 rounded-full"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:a.reportType}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(a.createdAt).toLocaleDateString()})]})]},a._id))})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("dashboard.quickActions")})}),e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsxs(c,{to:"/map",className:"flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(F,{className:"w-5 h-5 text-primary-500"}),e.jsx("span",{className:"text-gray-900",children:s("dashboard.quickViewMap")})]}),e.jsxs(c,{to:"/report",className:"flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(W,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-gray-900",children:s("dashboard.quickSubmitReport")})]}),e.jsxs(c,{to:"/profile",className:"flex items-center space-x-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx(G,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"text-gray-900",children:s("dashboard.quickViewProfile")})]})]})]})]})]})]})]})}function le(){const{state:t}=B();return t.isAuthenticated?e.jsx(ee,{}):e.jsx(X,{})}export{le as default};
//# sourceMappingURL=HomePage-jFvL--Bw.js.map
