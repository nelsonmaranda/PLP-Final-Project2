import{b as te,u as ie,a as x,j as e}from"./index-BvF2MNLF.js";import{r as c}from"./vendor-BKU87Gzz.js";import{q as le,A as L,R as I,Q as ce,g as O,T as ne,k as U,F as M,y as re,Z as de,V as me,n as oe,Y as xe,_ as he,$ as ue}from"./icons-laTIaZ17.js";import"./router-Z6rqMkFf.js";function ge(){var z;const{state:f}=te(),{t:a}=ie(),[Z,o]=c.useState(!0),[R,r]=c.useState(null),[u,q]=c.useState("efficiency"),[B,A]=c.useState([]),[G,$]=c.useState([]),[E,_]=c.useState([]),[K,k]=c.useState([]),[F,D]=c.useState([]),[g,P]=c.useState(null),[N,Q]=c.useState(10),[y,v]=c.useState([]),[n,b]=c.useState(""),[j,V]=c.useState([]),[d,w]=c.useState(""),[m,S]=c.useState(""),[p,W]=c.useState("08:00"),[T,Y]=c.useState("weekly");c.useEffect(()=>{(async()=>{try{const t=await x.getRoutes({page:1,limit:200,sort:"name",order:"asc"});if(t.success&&t.data&&t.data.routes){const l=t.data.routes.map(i=>({_id:i._id,name:i.name,routeNumber:i.routeNumber,stops:i.stops}));v(l)}else v([])}catch(t){console.error("Failed to load routes for analytics",t),v([])}})()},[]),c.useEffect(()=>{var l;const s=y.find(i=>i._id===n),t=((l=s==null?void 0:s.stops)==null?void 0:l.map(i=>i.name))||[];V(t),w(i=>t.includes(i)?i:""),S(i=>t.includes(i)?i:"")},[n,y]);const h=c.useCallback(async()=>{var s;if(!((s=f.user)!=null&&s._id)){r(a("common.error")),o(!1);return}o(!0),r(null);try{const t=await x.getUserRecommendations(f.user._id,{limit:N});if(t.success&&t.data?P(t.data):P(null),n){const[l,i,C]=await Promise.all([x.getRouteEfficiency(n),x.analyzeTrends(n,T),x.forecastDemand(n,p)]);A(l.success&&l.data?[l.data]:[]),k(i.success&&i.data?[i.data]:[]),D(C.success&&C.data?[C.data]:[])}else A([]),k([]),D([]);_([]),$([])}catch(t){console.error("Error loading analytics data:",t),r(a("analytics.errorTitle"))}finally{o(!1)}},[(z=f.user)==null?void 0:z._id,n,T,p,N]);c.useEffect(()=>{h()},[h]);const H=async()=>{try{if(!n||!d||!m){r(a("analytics.selectRoute"));return}o(!0),r(null);const s=await x.predictTravelTime(n,d,m,p);$(s.success&&s.data?[s.data]:[])}catch(s){console.error(s),r(a("common.error"))}finally{o(!1)}},J=async()=>{try{if(!d||!m){r(a("common.error"));return}o(!0),r(null);const s=await x.findAlternativeRoutes(d,m);_(s.success&&s.data?s.data.alternatives:[])}catch(s){console.error(s),r(a("common.error"))}finally{o(!1)}},X=s=>{switch(s){case"increasing":case"improving":case"safer":return e.jsx(ue,{className:"w-4 h-4 text-green-500"});case"decreasing":case"declining":case"riskier":return e.jsx(he,{className:"w-4 h-4 text-red-500"});default:return e.jsx(xe,{className:"w-4 h-4 text-gray-500"})}},ee=s=>{switch(s){case"increasing":case"improving":case"safer":return"text-green-600";case"decreasing":case"declining":case"riskier":return"text-red-600";default:return"text-gray-600"}},se=s=>s>=80?"text-green-600":s>=60?"text-yellow-600":"text-red-600",ae=s=>s>=80?"bg-green-100":s>=60?"bg-yellow-100":"bg-red-100";return Z?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"h-10 w-10 text-primary-500 animate-spin"}),e.jsx("p",{className:"text-gray-600 mt-4",children:a("analytics.loading")})]})}):R?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center p-6 bg-white rounded-lg shadow-md",children:[e.jsx(L,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:a("analytics.errorTitle")}),e.jsx("p",{className:"text-gray-600 mb-4",children:R}),e.jsxs("button",{onClick:h,className:"btn btn-primary",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),a("analytics.retry")]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"px-6 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:a("analytics.headerTitle")}),e.jsx("p",{className:"text-gray-600",children:a("analytics.headerSubtitle")})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"efficiency",name:a("analytics.tabs.efficiency"),icon:ce},{id:"predictions",name:a("analytics.tabs.predictions"),icon:O},{id:"trends",name:a("analytics.tabs.trends"),icon:ne},{id:"recommendations",name:a("analytics.tabs.recommendations"),icon:U}].map(s=>{const t=s.icon;return e.jsxs("button",{onClick:()=>q(s.id),className:`flex items-center space-x-2 py-2 px-1 border-b-2 font-medium text-sm ${u===s.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(t,{className:"w-4 h-4"}),e.jsx("span",{children:s.name})]},s.id)})})})}),e.jsxs("div",{className:"space-y-6",children:[u==="efficiency"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:a("analytics.efficiencyTitle")}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:n,onChange:s=>b(s.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:a("analytics.selectRoute")}),y.map(s=>e.jsx("option",{value:s._id,children:s.routeNumber?`${s.routeNumber} - ${s.name}`:s.name},s._id))]}),e.jsxs("button",{className:"btn btn-outline",onClick:h,disabled:!n,children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),a("analytics.refresh")]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:B.map(s=>e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.routeName}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${ae(s.efficiencyScore)} ${se(s.efficiencyScore)}`,children:[s.efficiencyScore,"/100"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(s.factors).map(([t,l])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 capitalize",children:t}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-500 h-2 rounded-full",style:{width:`${l}%`}})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:l})]})]},t))}),s.recommendations.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:a("analytics.recommendations")}),e.jsx("ul",{className:"space-y-1",children:s.recommendations.map((t,l)=>e.jsxs("li",{className:"flex items-start space-x-2 text-sm text-gray-600",children:[e.jsx(re,{className:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:t})]},l))})]})]})]},s.routeId))})]}),u==="predictions"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:a("analytics.travelPredictionsTitle")}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:n,onChange:s=>b(s.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:a("analytics.selectRoute")}),y.map(s=>e.jsx("option",{value:s._id,children:s.routeNumber?`${s.routeNumber} - ${s.name}`:s.name},s._id))]}),e.jsxs("select",{value:d,onChange:s=>w(s.target.value),className:"form-select",disabled:!n,children:[e.jsx("option",{value:"",children:a("analytics.fromStop")}),j.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:m,onChange:s=>S(s.target.value),className:"form-select",disabled:!n,children:[e.jsx("option",{value:"",children:a("analytics.toStop")}),j.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx("input",{type:"time",value:p,onChange:s=>W(s.target.value),className:"form-input"}),e.jsxs("button",{className:"btn btn-primary",onClick:H,disabled:!n||!d||!m,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),a("analytics.predict")]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:G.map((s,t)=>e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[s.fromStop," â†’ ",s.toStop]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary-600",children:[s.predictedTime," ",a("analytics.minutesShort")]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.confidence,"% ",a("analytics.confidence")]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[s.alternativeTimes.optimistic," ",a("analytics.minutesShort")]}),e.jsx("div",{className:"text-xs text-green-600",children:a("analytics.optimistic")})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-semibold text-blue-600",children:[s.alternativeTimes.realistic," ",a("analytics.minutesShort")]}),e.jsx("div",{className:"text-xs text-blue-600",children:a("analytics.realistic")})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-semibold text-red-600",children:[s.alternativeTimes.pessimistic," ",a("analytics.minutesShort")]}),e.jsx("div",{className:"text-xs text-red-600",children:a("analytics.pessimistic")})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:a("analytics.factors")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:Object.entries(s.factors).map(([l,i])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 capitalize",children:l.replace(/([A-Z])/g," $1")}),e.jsxs("span",{className:"font-medium",children:[i.toFixed(2),"x"]})]},l))})]})]})]},t))}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:a("analytics.alternativeRoutesTitle")}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:d,onChange:s=>w(s.target.value),className:"form-select",disabled:!n,children:[e.jsx("option",{value:"",children:a("analytics.fromStop")}),j.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:m,onChange:s=>S(s.target.value),className:"form-select",disabled:!n,children:[e.jsx("option",{value:"",children:a("analytics.toStop")}),j.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("button",{className:"btn btn-outline",onClick:J,disabled:!d||!m,children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),a("analytics.find")]})]})]}),E.length>0&&e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:E.map((s,t)=>e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.routeName}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.efficiency,"/100"]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.totalTime," min"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsxs("span",{children:["Ksh ",s.totalCost]})]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"text-xs text-gray-500",children:[a("analytics.reasons"),": ",s.reasons.join(", ")]})})]},t))})]})]}),u==="trends"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:a("analytics.trendAnalysisTitle")}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:n,onChange:s=>b(s.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:a("analytics.selectRoute")}),y.map(s=>e.jsx("option",{value:s._id,children:s.routeNumber?`${s.routeNumber} - ${s.name}`:s.name},s._id))]}),e.jsxs("select",{value:T,onChange:s=>Y(s.target.value),className:"form-select",children:[e.jsx("option",{value:"daily",children:a("analytics.periodDaily")}),e.jsx("option",{value:"weekly",children:a("analytics.periodWeekly")}),e.jsx("option",{value:"monthly",children:a("analytics.periodMonthly")})]}),e.jsxs("button",{className:"btn btn-outline",onClick:h,disabled:!n,children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),a("analytics.update")]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:K.map((s,t)=>e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:[a("analytics.routeTrends")," (",s.period,")"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(s.trends).map(([l,i])=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900 capitalize",children:l}),e.jsxs("div",{className:"flex items-center space-x-2",children:[X(i.trend),e.jsxs("span",{className:`text-sm font-medium ${ee(i.trend)}`,children:[i.change>0?"+":"",i.change.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:[a("analytics.current"),": ",i.current]}),e.jsxs("span",{children:[a("analytics.previous"),": ",i.previous]})]})]},l))}),s.insights.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:a("analytics.insights")}),e.jsx("ul",{className:"space-y-1",children:s.insights.map((l,i)=>e.jsxs("li",{className:"flex items-start space-x-2 text-sm text-gray-600",children:[e.jsx(L,{className:"w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:l})]},i))})]})]},t))})]}),u==="recommendations"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:a("analytics.recommendationsTitle")}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("label",{className:"text-sm text-gray-600",children:a("analytics.recommendedRoutes")}),e.jsx("select",{value:N,onChange:s=>Q(Number(s.target.value)),className:"form-select",children:[5,10,15,20,30,50].map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs("button",{className:"btn btn-primary",onClick:h,children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),a("analytics.refresh")]})]})]}),g&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:a("analytics.yourPreferences")}),e.jsx("div",{className:"space-y-3",children:Object.entries(g.preferences).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600 capitalize",children:[s==="efficiency"&&a("analytics.prefEfficiency"),s==="safety"&&a("analytics.prefSafety"),s==="cost"&&a("analytics.prefCost"),s==="convenience"&&a("analytics.prefConvenience")]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-500 h-2 rounded-full",style:{width:`${t*100}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[Math.round(t*100),"%"]})]})]},s))})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:a("analytics.recommendedRoutes")}),e.jsx("div",{className:"space-y-3",children:g.recommendations.map((s,t)=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.routeName}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[s.score,"/100"]})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.reason==="Good performance"?a("analytics.goodPerformance"):s.reason}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("span",{className:`px-2 py-1 text-xs rounded-full ${s.type==="efficiency"?"bg-blue-100 text-blue-800":s.type==="safety"?"bg-green-100 text-green-800":s.type==="cost"?"bg-yellow-100 text-yellow-800":"bg-purple-100 text-purple-800"}`,children:[s.type==="efficiency"&&a("analytics.prefEfficiency"),s.type==="safety"&&a("analytics.prefSafety"),s.type==="cost"&&a("analytics.prefCost"),s.type==="convenience"&&a("analytics.prefConvenience")]})})]},t))})]})]}),F.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:a("analytics.demandForecastsTitle")}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:F.map((s,t)=>e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-semibold text-gray-900",children:[a("analytics.timeSlot"),": ",s.timeSlot]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-primary-600",children:[s.predictedDemand,"%"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.confidence,"% ",a("analytics.confidence")]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:e.jsx("div",{className:"bg-primary-500 h-2 rounded-full",style:{width:`${s.predictedDemand}%`}})}),s.recommendations.length>0&&e.jsx("div",{className:"text-sm text-gray-600",children:s.recommendations[0]})]},t))})]})]})]})]})})}export{ge as default};
//# sourceMappingURL=AnalyticsDashboard-CGcZMEr1.js.map
