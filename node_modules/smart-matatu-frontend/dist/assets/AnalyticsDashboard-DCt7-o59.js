import{u as re,b as ie,a as J,j as e}from"./index-Darj_tO4.js";import{r as n}from"./vendor-BKU87Gzz.js";import"./router-BF-yxxER.js";import"./icons-l6XdvyrE.js";const oe=()=>{var v,d,f;const{t}=re(),{state:x}=ie(),[l,p]=n.useState(null),[Q,h]=n.useState(!0),[o,X]=n.useState("7d"),[u,g]=n.useState(null);n.useEffect(()=>{y()},[o]);const y=async()=>{var s,i,w,R,M,k,D,_,B,S,L,T,z,C,P,U,A,E,F,$,H,V,W,O,I,K,q,G;try{h(!0),g(null);const c=await J.getAnalyticsDashboard(o),r=(c==null?void 0:c.data)??c;if(!r){p(null);return}const ae={userMetrics:{totalUsers:Number(((s=r.users)==null?void 0:s.totalUsers)??0),activeUsers:Number(((i=r.users)==null?void 0:i.activeUsers)??0),newUsers:Number(((w=r.users)==null?void 0:w.newUsers)??0),userRoles:(((R=r.users)==null?void 0:R.userRoles)??[]).map(a=>({role:a.role??a._id??"unknown",count:Number(a.count??0)}))},routeMetrics:{totalRoutes:Number(((M=r.routes)==null?void 0:M.totalRoutes)??0),activeRoutes:Number(((k=r.routes)==null?void 0:k.activeRoutes)??0),topOperators:(((D=r.routes)==null?void 0:D.routesByOperator)??[]).map(a=>({_id:a._id??"unknown",count:Number(a.count??0)}))},reportMetrics:{totalReports:Number(((_=r.reports)==null?void 0:_.totalReports)??0),recentReports:Number(((B=r.reports)==null?void 0:B.recentReports)??0),reportsByType:(((S=r.reports)==null?void 0:S.reportsByType)??[]).map(a=>({type:a.type??a._id??"other",count:Number(a.count??0)})),reportsBySeverity:(((L=r.reports)==null?void 0:L.reportsBySeverity)??[]).map(a=>({severity:a.severity??a._id??"low",count:Number(a.count??0)})),reportsByStatus:(((T=r.reports)==null?void 0:T.reportsByStatus)??[]).map(a=>({status:a.status??a._id??"pending",count:Number(a.count??0)}))},ratingMetrics:{totalRatings:Number(((z=r.ratings)==null?void 0:z.totalScores)??0),averageRating:Number(((C=r.ratings)==null?void 0:C.avgOverallRating)??0),topRatedRoutes:(((P=r.ratings)==null?void 0:P.topRatedRoutes)??[]).map(a=>({_id:a._id,routeName:a.routeName,routeNumber:a.routeNumber,operator:a.operator,avgRating:Number(a.avgRating??0),totalRatings:Number(a.totalRatings??0)}))},subscriptionMetrics:{totalSubscriptions:Number(((U=r.subscriptions)==null?void 0:U.totalSubscriptions)??0),activeSubscriptions:Number(((A=r.subscriptions)==null?void 0:A.activeSubscriptions)??0),subscriptionsByPlan:(((E=r.subscriptions)==null?void 0:E.subscriptionsByPlan)??[]).map(a=>({plan:a.plan??a._id??"free",count:Number(a.count??0)}))},paymentMetrics:{totalPayments:Number(((F=r.payments)==null?void 0:F.totalPayments)??0),successfulPayments:Number((($=r.payments)==null?void 0:$.successfulPayments)??0),successRate:((H=r.payments)==null?void 0:H.successRate)??"0%",totalRevenue:Number(((V=r.payments)==null?void 0:V.totalRevenue)??0),paymentsByMethod:(((W=r.payments)==null?void 0:W.paymentsByMethod)??[]).map(a=>({method:a.method??"unknown",count:Number(a.count??0),total:Number(a.total??0)}))},trafficMetrics:{totalRoutesWithTraffic:Number(((O=r.traffic)==null?void 0:O.totalRoutesWithTraffic)??0),averageCongestion:Number(((I=r.traffic)==null?void 0:I.averageCongestion)??0),trafficData:((K=r.traffic)==null?void 0:K.trafficData)??[]},geographicAnalytics:{reportHotspots:((q=r.geographicAnalytics)==null?void 0:q.reportHotspots)??[]},timeAnalytics:{reportsByHour:((G=r.timeAnalytics)==null?void 0:G.reportsByHour)??[]},performanceMetrics:r.performanceMetrics??[]};p(ae)}catch(c){g(c instanceof Error?c.message:"Failed to load analytics data")}finally{h(!1)}},Y=async()=>{if(x.user)try{await J.trackEvent("page_view",{page:"analytics_dashboard",timestamp:new Date().toISOString()},void 0,x.user._id)}catch(s){console.error("Failed to track page view:",s)}};n.useEffect(()=>{Y()},[]);const Z=(s,i)=>{switch(s){case"api_response_time":return`${i.toFixed(2)}ms`;case"page_load_time":return`${i.toFixed(2)}s`;case"error_rate":return`${(i*100).toFixed(2)}%`;case"user_engagement":return i.toFixed(1);default:return i.toString()}},ee=(s,i)=>{switch(s){case"api_response_time":return i<200?"text-green-600":i<500?"text-yellow-600":"text-red-600";case"page_load_time":return i<2?"text-green-600":i<5?"text-yellow-600":"text-red-600";case"error_rate":return i<.01?"text-green-600":i<.05?"text-yellow-600":"text-red-600";case"user_engagement":return i>5?"text-green-600":i>2?"text-yellow-600":"text-red-600";default:return"text-gray-600"}},se=s=>{switch(s){case"api_response_time":return t("analyticsDashboard.metricTypes.apiResponseTime");case"page_load_time":return t("analyticsDashboard.metricTypes.pageLoadTime");case"error_rate":return t("analyticsDashboard.metricTypes.errorRate");case"user_engagement":return t("analyticsDashboard.metricTypes.userEngagement");default:return s.replace("_"," ").replace(/\b\w/g,i=>i.toUpperCase())}};if(Q)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:t("common.loading")})]})});if(u)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-6 max-w-md",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:t("analyticsDashboard.error")}),e.jsx("p",{className:"mt-1 text-sm text-red-700",children:u}),e.jsx("button",{onClick:y,className:"mt-3 bg-red-100 text-red-800 px-3 py-1 rounded-md text-sm hover:bg-red-200",children:t("common.retry")})]})]})})})});const N=(l==null?void 0:l.userMetrics)||{totalUsers:0,userRoles:[]},m=(l==null?void 0:l.reportMetrics)||{totalReports:0,reportsByType:[],reportsBySeverity:[]},j=(l==null?void 0:l.ratingMetrics)||{averageRating:0,topRatedRoutes:[]},te=(l==null?void 0:l.subscriptionMetrics)||{subscriptionsByPlan:[]},b=(l==null?void 0:l.performanceMetrics)||[];return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:t("analyticsDashboard.title")}),e.jsx("p",{className:"mt-2 text-gray-600",children:t("analyticsDashboard.subtitle")})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs("select",{value:o,onChange:s=>X(s.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"7d",children:t("analyticsDashboard.last7Days")}),e.jsx("option",{value:"30d",children:t("analyticsDashboard.last30Days")})]})})]})}),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:t("analyticsDashboard.userMetrics.totalUsers")}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:N.totalUsers})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:t("analyticsDashboard.reportMetrics.totalReports")}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:m.totalReports})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:t("analyticsDashboard.ratingMetrics.averageRating")}),e.jsxs("dd",{className:"text-lg font-medium text-gray-900",children:[(j.averageRating||0).toFixed(1),"/5"]})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 truncate",children:[t("analyticsDashboard.paymentMetrics.totalRevenue")," (KES)"]}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:((f=(d=(v=l==null?void 0:l.paymentMetrics)==null?void 0:v.totalRevenue)==null?void 0:d.toLocaleString)==null?void 0:f.call(d))||"0"})]})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:t("analyticsDashboard.reportMetrics.reportsByType")}),e.jsx("div",{className:"space-y-3",children:m.reportsByType.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-3"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:t(`analyticsDashboard.reportTypes.${s.type}`)})]}),e.jsx("span",{className:"text-sm text-gray-500",children:s.count})]},s.type))})]})}),e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:t("analyticsDashboard.reportMetrics.reportsBySeverity")}),e.jsx("div",{className:"space-y-3",children:m.reportsBySeverity.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-3 ${s.severity==="critical"?"bg-red-600":s.severity==="high"?"bg-orange-500":s.severity==="medium"?"bg-yellow-500":"bg-green-500"}`}),e.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:t(`analyticsDashboard.severityLevels.${s.severity}`)})]}),e.jsx("span",{className:"text-sm text-gray-500",children:s.count})]},s.severity))})]})})]}),e.jsx("div",{className:"bg-white shadow rounded-lg mb-8",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:t("analyticsDashboard.ratingMetrics.topRatedRoutes")}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("analyticsDashboard.ratingMetrics.routeName")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("analyticsDashboard.ratingMetrics.operator")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("analyticsDashboard.ratingMetrics.avgRating")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("analyticsDashboard.ratingMetrics.totalRatings")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.topRatedRoutes.slice(0,10).map(s=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[s.routeNumber," - ",s.routeName]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.operator}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-yellow-400",children:"★"}),e.jsx("span",{className:"ml-1",children:s.avgRating.toFixed(1)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.totalRatings})]},s._id))})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:t("analyticsDashboard.userMetrics.userRoles")}),e.jsx("div",{className:"space-y-3",children:N.userRoles.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-3"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:t(`analyticsDashboard.userRoles.${s.role}`)})]}),e.jsx("span",{className:"text-sm text-gray-500",children:s.count})]},s.role))})]})}),e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:t("analyticsDashboard.subscriptionMetrics.subscriptionsByPlan")}),e.jsx("div",{className:"space-y-3",children:te.subscriptionsByPlan.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-3"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:t(`analyticsDashboard.subscriptionPlans.${s.plan}`)})]}),e.jsx("span",{className:"text-sm text-gray-500",children:s.count})]},s.plan))})]})})]}),e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:t("analyticsDashboard.performanceMetrics")}),b.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("analyticsDashboard.metric")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("analyticsDashboard.value")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("analyticsDashboard.endpoint")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:t("analyticsDashboard.timestamp")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.slice(0,10).map((s,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize",children:se(s.metricType)}),e.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm font-medium ${ee(s.metricType,s.value)}`,children:Z(s.metricType,s.value)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.endpoint||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.timestamp).toLocaleString()})]},i))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:t("analyticsDashboard.noMetrics")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t("analyticsDashboard.noMetricsDesc")})]})]})})]})]})})};export{oe as default};
//# sourceMappingURL=AnalyticsDashboard-DCt7-o59.js.map
