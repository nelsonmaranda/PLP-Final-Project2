import{b as F,u as A,j as e,a as b}from"./index-DJcsNwFI.js";import{r as t}from"./vendor-BKU87Gzz.js";import{b as T,u as B,L as h}from"./router-BF-yxxER.js";import{j as w,t as S,p as k,u as D,v as M,E as O,r as U,w as V}from"./icons-l6XdvyrE.js";function W(){const{setUser:P}=F(),{t:a}=A(),C=T(),j=B(),[r,d]=t.useState(!1),[o,L]=t.useState(!1),[l,i]=t.useState(null),[u,p]=t.useState(!1),[g,N]=t.useState(null),[m,x]=t.useState(null),[n,v]=t.useState({email:"",password:""});t.useEffect(()=>{const s=new URLSearchParams(j.search).get("verified");s==="1"?N("success"):s==="0"&&N("failed")},[j.search]);const y=t.useCallback(c=>{const{name:s,value:f}=c.target;v(R=>({...R,[s]:f})),l&&i(null),u&&p(!1),m&&x(null)},[l,u,m]),E=async()=>{try{d(!0),await fetch("https://us-central1-smart-matwana-ke.cloudfunctions.net/api/auth/resend-verification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n.email})}),x("Verification email sent. Please check your inbox.")}catch{x("Failed to resend verification link. Please try again later.")}finally{d(!1)}},I=async c=>{c.preventDefault(),d(!0),i(null),p(!1),x(null);try{const s=await b.login(n);s.success&&s.data&&s.data.user&&s.data.token?(P(s.data.user),p(!0),v({email:"",password:""}),(s.data.user.role==="admin"||s.data.user.role==="moderator")&&b.getReports(1,5).catch(()=>{}),C("/")):i("Invalid email or password. Please check your credentials.")}catch(s){const f=(s==null?void 0:s.message)||"";/not verified/i.test(f)?i("Email not verified. Please check your inbox or resend the verification link below."):i("Invalid email or password. Please check your credentials.")}finally{d(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs(h,{to:"/",className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-500 rounded-lg flex items-center justify-center",children:e.jsx(w,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:"Smart Matatu"})]})}),e.jsx("h1",{className:"mt-6 text-center text-3xl font-bold text-gray-900",children:a("auth.loginTitle")}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:a("auth.loginSubtitle")})]}),e.jsxs("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-content",children:[g==="success"&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"h-5 w-5 text-green-500"}),e.jsx("p",{className:"ml-2 text-sm text-green-800",children:"Your email has been verified. You can now sign in."})]})}),g==="failed"&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-5 w-5 text-yellow-500"}),e.jsx("p",{className:"ml-2 text-sm text-yellow-800",children:"Verification link expired or invalid. Enter your email and click Resend verification."})]})}),l&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",role:"alert","aria-live":"assertive",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-5 w-5 text-red-400","aria-hidden":"true"}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-red-800",children:l})})]}),l.toLowerCase().includes("not verified")&&e.jsxs("div",{className:"mt-3",children:[e.jsx("button",{onClick:E,disabled:r||!n.email,className:"btn btn-outline w-full",children:r?"Sendingâ€¦":"Resend verification email"}),m&&e.jsx("p",{className:"mt-2 text-xs text-gray-600",children:m})]})]}),u&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",role:"alert","aria-live":"polite",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(S,{className:"h-5 w-5 text-green-400","aria-hidden":"true"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Login successful! Welcome back to Smart Matatu."})})]})}),e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:a("auth.email")}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(w,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})}),e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",value:n.email,onChange:y,className:"form-input pl-10",placeholder:a("auth.emailPlaceholder"),required:!0,"aria-describedby":"email-help"})]}),e.jsx("p",{id:"email-help",className:"sr-only",children:a("auth.emailPlaceholder")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",className:"form-label",children:a("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(D,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})}),e.jsx("input",{id:"password",name:"password",type:o?"text":"password",autoComplete:"current-password",value:n.password,onChange:y,className:"form-input pl-10 pr-10",placeholder:a("auth.passwordPlaceholder"),required:!0,"aria-describedby":"password-help"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>L(!o),"aria-label":o?"Hide password":"Show password",children:o?e.jsx(M,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"}):e.jsx(O,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),e.jsx("p",{id:"password-help",className:"sr-only",children:a("auth.passwordPlaceholder")})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-sm",children:e.jsx(h,{to:"/forgot-password",className:"font-medium text-primary-600 hover:text-primary-500",children:a("auth.forgotPassword")})})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:r,className:"btn btn-primary w-full","aria-label":a(r?"auth.signingIn":"auth.signIn"),children:r?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2 animate-spin","aria-hidden":"true"}),a("auth.signingIn")]}):a("auth.signIn")})}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[a("auth.dontHaveAccount")," ",e.jsx(h,{to:"/signup",className:"font-medium text-primary-600 hover:text-primary-500",children:a("auth.signUp")})]})})]})]})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs(h,{to:"/",className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Back to home"]})})]})]})}export{W as default};
//# sourceMappingURL=Login-Dn3J0azy.js.map
