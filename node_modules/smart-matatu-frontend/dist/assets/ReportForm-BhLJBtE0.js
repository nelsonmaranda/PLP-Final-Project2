import{j as e,L as w,a as g}from"./index-N0cMQqFc.js";import{r}from"./vendor-BKU87Gzz.js";import{b as C}from"./router-Z6rqMkFf.js";import{q as R,r as k}from"./icons-B_aqzpWL.js";const j=["Super metro","Latema","Starbus","Embassava","Forward Travellers","ROG","Manchester","Zuri","MSL","Metro Trans","Lopha","Enabled","NNK","Double M","Risen","NMOA Compliant","City Shuttle","Citihoppa","Tram","Expresso","KMO","Buruburu"];function _(o){if(!o)return o;const c=new RegExp(`\\b(${j.map(n=>n.replace(/[-/\\^$*+?.()|[\]{}]/g,d=>d)).join("|")})\\b`,"i");return o.replace(c,"").replace(/\s{2,}/g," ").trim()}function M(){const o=C(),[c,n]=r.useState([]),[d,v]=r.useState(!0),[x,p]=r.useState(!1),[h,u]=r.useState(null),[y,f]=r.useState(!1),[a,i]=r.useState({routeId:"",reportType:"delay",severity:"medium",isAnonymous:!1,description:"",location:{type:"Point",coordinates:[36.8219,-1.2921]}}),[b,N]=r.useState(""),[l,m]=r.useState("along_route");r.useEffect(()=>{(async()=>{try{const t=await g.getRoutes({page:1,limit:200,sort:"name",order:"asc"});t.success&&t.data?n(t.data.routes):n([])}catch(t){console.error("Failed to load routes",t),n([])}finally{v(!1)}})()},[]);const S=async s=>{s.preventDefault(),p(!0),u(null);try{const t={...a,sacco:b||void 0,direction:l};(await g.createReport(t)).success?(f(!0),setTimeout(()=>o("/"),1200)):u("Failed to submit report")}catch(t){u(t.message||"Failed to submit report")}finally{p(!1)}};return d?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading report form..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto bg-white shadow rounded-lg p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Submit a Report"}),h&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded border border-red-200",children:h}),y&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 text-green-700 rounded border border-green-200",children:"Report submitted successfully"}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Route"}),e.jsxs("select",{value:a.routeId,onChange:s=>i(t=>({...t,routeId:s.target.value})),className:"w-full border rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",children:"Select a route"}),c.map(s=>e.jsx("option",{value:s._id,children:_(s.name)},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Matatu SACCO (optional)"}),e.jsxs("select",{value:b,onChange:s=>N(s.target.value),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"Select SACCO"}),j.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Direction"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("label",{className:"flex items-center space-x-2 border rounded px-3 py-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"direction",value:"from_cbd",checked:l==="from_cbd",onChange:()=>m("from_cbd")}),e.jsx("span",{children:"From CBD"})]}),e.jsxs("label",{className:"flex items-center space-x-2 border rounded px-3 py-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"direction",value:"to_cbd",checked:l==="to_cbd",onChange:()=>m("to_cbd")}),e.jsx("span",{children:"To CBD"})]}),e.jsxs("label",{className:"flex items-center space-x-2 border rounded px-3 py-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"direction",value:"along_route",checked:l==="along_route",onChange:()=>m("along_route")}),e.jsx("span",{children:"Along this route"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Report Type"}),e.jsxs("select",{value:a.reportType,onChange:s=>i(t=>({...t,reportType:s.target.value})),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"delay",children:"Delay"}),e.jsx("option",{value:"overcrowding",children:"Overcrowding"}),e.jsx("option",{value:"breakdown",children:"Breakdown"}),e.jsx("option",{value:"accident",children:"Accident"}),e.jsx("option",{value:"harassment",children:"Harassment"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Severity"}),e.jsxs("select",{value:a.severity,onChange:s=>i(t=>({...t,severity:s.target.value})),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"anonymous",type:"checkbox",checked:a.isAnonymous,onChange:s=>i(t=>({...t,isAnonymous:s.target.checked}))}),e.jsx("label",{htmlFor:"anonymous",className:"text-sm text-gray-700",children:"Submit anonymously"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:s=>i(t=>({...t,description:s.target.value})),className:"w-full border rounded px-3 py-2",rows:4,placeholder:"Describe the issue..."})]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",disabled:x,children:[x?e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(k,{className:"w-4 h-4 mr-2"}),"Submit Report"]})]})]})})}export{M as default};
//# sourceMappingURL=ReportForm-BhLJBtE0.js.map
