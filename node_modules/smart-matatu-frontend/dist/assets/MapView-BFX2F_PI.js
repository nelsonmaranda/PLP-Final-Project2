var q=Object.defineProperty;var J=(a,r,i)=>r in a?q(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i;var U=(a,r,i)=>J(a,typeof r!="symbol"?r+"":r,i);import{a as Q,j as e,L as B}from"./index-CQXv9Agm.js";import{r as l}from"./vendor-BKU87Gzz.js";import{M as G,T as W,P as X,a as Y,L as _,b as Z}from"./leaflet-DyOFlehG.js";import{g as ee,F as D,L as se,f as K,C as V,d as P,M as ae}from"./icons-BoF6UaG_.js";import"./router-hf4IkB-x.js";class te{constructor(){U(this,"cache",new Map)}set(r,i,N){const n=Date.now();this.cache.set(r,{data:i,timestamp:n,expiresAt:n+N})}get(r){const i=this.cache.get(r);return i?Date.now()>i.expiresAt?(this.cache.delete(r),null):i.data:null}clear(){this.cache.clear()}delete(r){this.cache.delete(r)}}const E=new te;function re(a,r=[],i={}){const{debounceMs:N=300,cacheTime:n=5*60*1e3,retryAttempts:F=3,retryDelay:c=1e3}=i,[x,R]=l.useState(null),[$,d]=l.useState(!1),[H,f]=l.useState(null),[y,m]=l.useState(0),g=l.useRef(),o=l.useRef(),h=JSON.stringify(r),p=l.useCallback(async(L=!1)=>{const v=E.get(h);if(v&&!L){R(v);return}o.current&&o.current.abort(),o.current=new AbortController;try{d(!0),f(null);const j=await a();E.set(h,j,n),R(j),m(0)}catch(j){const s=j;if(s.name==="AbortError")return;f(s),y<F&&(m(t=>t+1),setTimeout(()=>{p(!0)},c*Math.pow(2,y)))}finally{d(!1)}},[a,h,n,F,c,y]),b=l.useCallback(()=>{g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{p()},N)},[p,N]);l.useEffect(()=>(b(),()=>{g.current&&clearTimeout(g.current),o.current&&o.current.abort()}),[b]);const A=l.useCallback(()=>{E.delete(h),p()},[h,p]),M=l.useCallback(()=>{E.clear()},[]);return{data:x,loading:$,error:H,retryCount:y,refetch:A,clearCache:M}}const I=_.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});typeof _<"u"&&_.Marker&&(_.Marker.prototype.options.icon=I);function xe(){var h,p,b,A,M,L,v,j;const[a,r]=l.useState(null),[i,N]=l.useState(!1),[n,F]=l.useState(!1),[c,x]=l.useState({highReliability:!0,safeRoutes:!0,lowFare:!1}),R=[-1.2921,36.8219],$=l.useCallback(async()=>{const s=await Q.getRoutes({page:1,limit:50,sort:"createdAt",order:"desc"});return s.success&&s.data?s.data.routes:[]},[]),{data:d,loading:H,error:f,refetch:y}=re($,[c],{debounceMs:500,cacheTime:2*60*1e3,retryAttempts:2}),m=(d||[]).filter(s=>!(c.highReliability&&(!s.score||s.score.reliability<4)||c.safeRoutes&&(!s.score||s.score.safety<4)||c.lowFare&&s.fare>=50)),g=s=>s>=4.5?"#22c55e":s>=3.5?"#f59e0b":s>=2.5?"#f97316":"#ef4444",o=s=>s.score?g(s.score.overall):"#3b82f6";return H?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading routes..."})]})}):f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:(f==null?void 0:f.message)||"An error occurred"}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Try Again"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"container py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"card-title",children:"Nairobi Matatu Routes"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:`btn btn-sm ${i?"btn-primary":"btn-outline"}`,onClick:()=>N(!i),"aria-label":"Toggle filter panel","aria-pressed":i,children:[e.jsx(D,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filter"]}),e.jsxs("button",{className:`btn btn-sm ${n?"btn-primary":"btn-outline"}`,onClick:()=>F(!n),"aria-label":"Toggle list view","aria-pressed":n,children:[e.jsx(se,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"List"]})]})]})}),e.jsxs("div",{className:"card-content p-0",children:[i&&e.jsx("div",{className:"p-4 bg-gray-50 border-b",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-500","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Quick Filters"})]}),e.jsxs("fieldset",{className:"flex flex-wrap gap-4",children:[e.jsx("legend",{className:"sr-only",children:"Route filters"}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.highReliability,onChange:s=>x(t=>({...t,highReliability:s.target.checked}))}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"High Reliability (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.safeRoutes,onChange:s=>x(t=>({...t,safeRoutes:s.target.checked}))}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Safe Routes (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.lowFare,onChange:s=>x(t=>({...t,lowFare:s.target.checked}))}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Low Fare (Under 50 KES)"})]})]})]})}),n?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:[m.length," of ",(d==null?void 0:d.length)||0," routes"]}),m.map(s=>{var t,u;return e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${(a==null?void 0:a._id)===s._id?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>r(s),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.operator," - Route ",s.routeNumber]}),e.jsxs("div",{className:"flex items-center mt-2 space-x-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"w-3 h-3 text-yellow-500 mr-1"}),e.jsx("span",{children:((u=(t=s.score)==null?void 0:t.overall)==null?void 0:u.toFixed(1))||"N/A"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-3 h-3 text-blue-500 mr-1"}),e.jsxs("span",{children:[s.operatingHours.start," - ",s.operatingHours.end]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["KES ",s.fare]}),e.jsx("div",{className:"w-4 h-4 rounded-full mt-1 ml-auto",style:{backgroundColor:o(s)}})]})]})},s._id)})]})}):e.jsx("div",{className:"map-container h-96",role:"img","aria-label":"Interactive map showing Nairobi matatu routes",children:e.jsxs(G,{center:R,zoom:11,style:{height:"100%",width:"100%"},children:[e.jsx(W,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),m.map(s=>e.jsxs("div",{children:[e.jsx(X,{positions:s.path,color:o(s),weight:(a==null?void 0:a._id)===s._id?6:4,opacity:(a==null?void 0:a._id)===s._id?.8:.6}),s.stops.map((t,u)=>{var w,k,C,S;return e.jsx(Y,{position:t.coordinates,icon:I,children:e.jsx(Z,{children:e.jsxs("div",{className:"p-2",children:[e.jsx("h3",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.operator}),e.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"h-3 w-3 mr-1 text-yellow-400"}),((k=(w=s.score)==null?void 0:w.overall)==null?void 0:k.toFixed(1))||"N/A"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),((S=(C=s.score)==null?void 0:C.safety)==null?void 0:S.toFixed(1))||"N/A"]}),e.jsxs("div",{className:"text-gray-600",children:[s.fare," KES"]})]})]})})},u)})]},s._id))]})})]})]})}),e.jsxs("div",{className:"w-full lg:w-80",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Available Routes"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[m.length," of ",(d==null?void 0:d.length)||0," routes"]})]}),e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-500","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filters"})]}),e.jsxs("fieldset",{className:"space-y-2",children:[e.jsx("legend",{className:"sr-only",children:"Route filters"}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.highReliability,onChange:s=>x(t=>({...t,highReliability:s.target.checked})),"aria-describedby":"high-reliability-desc"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"High Reliability (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.safeRoutes,onChange:s=>x(t=>({...t,safeRoutes:s.target.checked})),"aria-describedby":"safe-routes-desc"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Safe Routes (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.lowFare,onChange:s=>x(t=>({...t,lowFare:s.target.checked})),"aria-describedby":"low-fare-desc"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Low Fare (Under 50 KES)"})]})]})]})}),e.jsx("div",{className:"card-content p-0",children:e.jsx("div",{className:"divide-y divide-gray-200",children:m.map(s=>{var t,u,w,k,C,S,O,z;return e.jsx("div",{className:`p-4 cursor-pointer hover:bg-gray-50 transition-colors ${(a==null?void 0:a._id)===s._id?"bg-primary-50 border-r-4 border-primary-500":""}`,onClick:()=>r(s),role:"button",tabIndex:0,onKeyDown:T=>{(T.key==="Enter"||T.key===" ")&&(T.preventDefault(),r(s))},"aria-label":`Select route ${s.name} by ${s.operator}`,"aria-pressed":(a==null?void 0:a._id)===s._id,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.operator}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"w-4 h-4 text-yellow-500 mr-1","aria-hidden":"true"}),e.jsx("span",{"aria-label":`Overall rating: ${((u=(t=s.score)==null?void 0:t.overall)==null?void 0:u.toFixed(1))||"N/A"} stars`,children:((k=(w=s.score)==null?void 0:w.overall)==null?void 0:k.toFixed(1))||"N/A"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-blue-500 mr-1","aria-hidden":"true"}),e.jsxs("span",{"aria-label":`Operating hours: ${s.operatingHours.start} to ${s.operatingHours.end}`,children:[s.operatingHours.start," - ",s.operatingHours.end]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"w-4 h-4 text-green-500 mr-1","aria-hidden":"true"}),e.jsx("span",{"aria-label":`Safety rating: ${((S=(C=s.score)==null?void 0:C.safety)==null?void 0:S.toFixed(1))||"N/A"} stars`,children:((z=(O=s.score)==null?void 0:O.safety)==null?void 0:z.toFixed(1))||"N/A"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["KES ",s.fare]}),e.jsx("div",{className:"w-4 h-4 rounded-full mt-1",style:{backgroundColor:o(s)},"aria-label":`Route quality indicator: ${o(s)}`})]})]})},s._id)})})})]}),a&&e.jsxs("div",{className:"card mt-4",role:"region","aria-labelledby":"route-details-heading",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{id:"route-details-heading",className:"text-lg font-semibold",children:"Route Details"})}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.operator}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Real-time updates available"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600","aria-label":`Reliability score: ${((p=(h=a.score)==null?void 0:h.reliability)==null?void 0:p.toFixed(1))||"N/A"} out of 5`,children:((A=(b=a.score)==null?void 0:b.reliability)==null?void 0:A.toFixed(1))||"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Reliability"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-secondary-600","aria-label":`Safety score: ${((L=(M=a.score)==null?void 0:M.safety)==null?void 0:L.toFixed(1))||"N/A"} out of 5`,children:((j=(v=a.score)==null?void 0:v.safety)==null?void 0:j.toFixed(1))||"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Safety"})]})]}),e.jsxs("dl",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Fare:"}),e.jsxs("dd",{className:"font-medium",children:["KES ",a.fare]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Operating Hours:"}),e.jsxs("dd",{className:"font-medium",children:[a.operatingHours.start," - ",a.operatingHours.end]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Stops:"}),e.jsxs("dd",{className:"font-medium",children:[a.stops.length," stops"]})]})]}),e.jsxs("button",{className:"btn btn-primary w-full","aria-label":"View selected route on map",children:[e.jsx(ae,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"View on Map"]})]})})]})]})]})})})}export{xe as default};
//# sourceMappingURL=MapView-BFX2F_PI.js.map
