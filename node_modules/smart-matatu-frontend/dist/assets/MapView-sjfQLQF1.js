var q=Object.defineProperty;var B=(a,r,i)=>r in a?q(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i;var P=(a,r,i)=>B(a,typeof r!="symbol"?r+"":r,i);import{a as U,j as e,L as J}from"./index-Mq6EYbo-.js";import{r as l}from"./vendor-BKU87Gzz.js";import{M as Q,T as G,P as X,a as Y,L as E,b as Z}from"./leaflet-DyOFlehG.js";import{g as ee,F as D,L as se,f as K,C as V,d as I,M as ae}from"./icons-BoF6UaG_.js";import"./router-hf4IkB-x.js";class te{constructor(){P(this,"cache",new Map)}set(r,i,b){const d=Date.now();this.cache.set(r,{data:i,timestamp:d,expiresAt:d+b})}get(r){const i=this.cache.get(r);return i?Date.now()>i.expiresAt?(this.cache.delete(r),null):i.data:null}clear(){this.cache.clear()}delete(r){this.cache.delete(r)}}const _=new te;function re(a,r=[],i={}){const{debounceMs:b=300,cacheTime:d=5*60*1e3,retryAttempts:R=3,retryDelay:c=1e3}=i,[m,F]=l.useState(null),[$,o]=l.useState(!1),[H,j]=l.useState(null),[v,h]=l.useState(0),u=l.useRef(),x=l.useRef(),p=JSON.stringify(r),f=l.useCallback(async(L=!1)=>{const k=_.get(p);if(k&&!L){F(k);return}x.current&&x.current.abort(),x.current=new AbortController;try{o(!0),j(null);const N=await a();_.set(p,N,d),F(N),h(0)}catch(N){const s=N;if(s.name==="AbortError")return;j(s),v<R&&(h(t=>t+1),setTimeout(()=>{f(!0)},c*Math.pow(2,v)))}finally{o(!1)}},[a,p,d,R,c,v]),w=l.useCallback(()=>{u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{f()},b)},[f,b]);l.useEffect(()=>(w(),()=>{u.current&&clearTimeout(u.current),x.current&&x.current.abort()}),[w]);const A=l.useCallback(()=>{_.delete(p),f()},[p,f]),M=l.useCallback(()=>{_.clear()},[]);return{data:m,loading:$,error:H,retryCount:v,refetch:A,clearCache:M}}const W=E.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});typeof E<"u"&&E.Marker&&(E.Marker.prototype.options.icon=W);function xe(){var p,f,w,A,M,L,k,N;const[a,r]=l.useState(null),[i,b]=l.useState(!1),[d,R]=l.useState(!1),[c,m]=l.useState({highReliability:!0,safeRoutes:!0,lowFare:!1}),F=[-1.2921,36.8219],$=l.useCallback(async()=>{const s=await U.getRoutes({page:1,limit:50,sort:"createdAt",order:"desc"});return s.success&&s.data?await Promise.all(s.data.routes.map(async n=>{var g;try{const y=await U.getScoresByRoute(n._id);return{...n,score:(g=y.data)==null?void 0:g.score}}catch{return n}})):[]},[]),{data:o,loading:H,error:j,refetch:v}=re($,[c],{debounceMs:500,cacheTime:2*60*1e3,retryAttempts:2}),h=(o||[]).filter(s=>!(c.highReliability&&(!s.score||s.score.reliability<4)||c.safeRoutes&&(!s.score||s.score.safety<4)||c.lowFare&&s.fare>=50)),u=s=>s>=4.5?"#22c55e":s>=3.5?"#f59e0b":s>=2.5?"#f97316":"#ef4444",x=s=>s.score?u(s.score.overall):"#3b82f6";return H?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(J,{}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading routes..."})]})}):j?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:(j==null?void 0:j.message)||"An error occurred"}),e.jsx("button",{onClick:v,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Try Again"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"container py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"card-title",children:"Nairobi Matatu Routes"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:`btn btn-sm ${i?"btn-primary":"btn-outline"}`,onClick:()=>b(!i),"aria-label":"Toggle filter panel","aria-pressed":i,children:[e.jsx(D,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Filter"]}),e.jsxs("button",{className:`btn btn-sm ${d?"btn-primary":"btn-outline"}`,onClick:()=>R(!d),"aria-label":"Toggle list view","aria-pressed":d,children:[e.jsx(se,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"List"]})]})]})}),e.jsxs("div",{className:"card-content p-0",children:[i&&e.jsx("div",{className:"p-4 bg-gray-50 border-b",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-500","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Quick Filters"})]}),e.jsxs("fieldset",{className:"flex flex-wrap gap-4",children:[e.jsx("legend",{className:"sr-only",children:"Route filters"}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.highReliability,onChange:s=>m(t=>({...t,highReliability:s.target.checked}))}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"High Reliability (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.safeRoutes,onChange:s=>m(t=>({...t,safeRoutes:s.target.checked}))}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Safe Routes (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.lowFare,onChange:s=>m(t=>({...t,lowFare:s.target.checked}))}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Low Fare (Under 50 KES)"})]})]})]})}),d?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:[h.length," of ",(o==null?void 0:o.length)||0," routes"]}),h.map(s=>{var t,n;return e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${(a==null?void 0:a._id)===s._id?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>r(s),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.operator," - Route ",s.routeNumber]}),e.jsxs("div",{className:"flex items-center mt-2 space-x-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"w-3 h-3 text-yellow-500 mr-1"}),e.jsx("span",{children:((n=(t=s.score)==null?void 0:t.overall)==null?void 0:n.toFixed(1))||"N/A"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-3 h-3 text-blue-500 mr-1"}),e.jsxs("span",{children:[s.operatingHours.start," - ",s.operatingHours.end]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["KES ",s.fare]}),e.jsx("div",{className:"w-4 h-4 rounded-full mt-1 ml-auto",style:{backgroundColor:x(s)}})]})]})},s._id)})]})}):e.jsx("div",{className:"map-container h-96",role:"img","aria-label":"Interactive map showing Nairobi matatu routes",children:e.jsxs(Q,{center:F,zoom:11,style:{height:"100%",width:"100%"},children:[e.jsx(G,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),h.map(s=>e.jsxs("div",{children:[e.jsx(X,{positions:s.path,color:x(s),weight:(a==null?void 0:a._id)===s._id?6:4,opacity:(a==null?void 0:a._id)===s._id?.8:.6}),s.stops.map((t,n)=>{var g,y,S,C;return e.jsx(Y,{position:t.coordinates,icon:W,children:e.jsx(Z,{children:e.jsxs("div",{className:"p-2",children:[e.jsx("h3",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.operator}),e.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"h-3 w-3 mr-1 text-yellow-400"}),((y=(g=s.score)==null?void 0:g.overall)==null?void 0:y.toFixed(1))||"N/A"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),((C=(S=s.score)==null?void 0:S.safety)==null?void 0:C.toFixed(1))||"N/A"]}),e.jsxs("div",{className:"text-gray-600",children:[s.fare," KES"]})]})]})})},n)})]},s._id))]})})]})]})}),e.jsxs("div",{className:"w-full lg:w-80",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Available Routes"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[h.length," of ",(o==null?void 0:o.length)||0," routes"]})]}),e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-500","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filters"})]}),e.jsxs("fieldset",{className:"space-y-2",children:[e.jsx("legend",{className:"sr-only",children:"Route filters"}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.highReliability,onChange:s=>m(t=>({...t,highReliability:s.target.checked})),"aria-describedby":"high-reliability-desc"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"High Reliability (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.safeRoutes,onChange:s=>m(t=>({...t,safeRoutes:s.target.checked})),"aria-describedby":"safe-routes-desc"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Safe Routes (4+ stars)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:c.lowFare,onChange:s=>m(t=>({...t,lowFare:s.target.checked})),"aria-describedby":"low-fare-desc"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Low Fare (Under 50 KES)"})]})]})]})}),e.jsx("div",{className:"card-content p-0",children:e.jsx("div",{className:"divide-y divide-gray-200",children:h.map(s=>{var t,n,g,y,S,C,O,z;return e.jsx("div",{className:`p-4 cursor-pointer hover:bg-gray-50 transition-colors ${(a==null?void 0:a._id)===s._id?"bg-primary-50 border-r-4 border-primary-500":""}`,onClick:()=>r(s),role:"button",tabIndex:0,onKeyDown:T=>{(T.key==="Enter"||T.key===" ")&&(T.preventDefault(),r(s))},"aria-label":`Select route ${s.name} by ${s.operator}`,"aria-pressed":(a==null?void 0:a._id)===s._id,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.operator}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"w-4 h-4 text-yellow-500 mr-1","aria-hidden":"true"}),e.jsx("span",{"aria-label":`Overall rating: ${((n=(t=s.score)==null?void 0:t.overall)==null?void 0:n.toFixed(1))||"N/A"} stars`,children:((y=(g=s.score)==null?void 0:g.overall)==null?void 0:y.toFixed(1))||"N/A"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-blue-500 mr-1","aria-hidden":"true"}),e.jsxs("span",{"aria-label":`Operating hours: ${s.operatingHours.start} to ${s.operatingHours.end}`,children:[s.operatingHours.start," - ",s.operatingHours.end]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"w-4 h-4 text-green-500 mr-1","aria-hidden":"true"}),e.jsx("span",{"aria-label":`Safety rating: ${((C=(S=s.score)==null?void 0:S.safety)==null?void 0:C.toFixed(1))||"N/A"} stars`,children:((z=(O=s.score)==null?void 0:O.safety)==null?void 0:z.toFixed(1))||"N/A"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:["KES ",s.fare]}),e.jsx("div",{className:"w-4 h-4 rounded-full mt-1",style:{backgroundColor:x(s)},"aria-label":`Route quality indicator: ${x(s)}`})]})]})},s._id)})})})]}),a&&e.jsxs("div",{className:"card mt-4",role:"region","aria-labelledby":"route-details-heading",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{id:"route-details-heading",className:"text-lg font-semibold",children:"Route Details"})}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.operator}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Real-time updates available"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600","aria-label":`Reliability score: ${((f=(p=a.score)==null?void 0:p.reliability)==null?void 0:f.toFixed(1))||"N/A"} out of 5`,children:((A=(w=a.score)==null?void 0:w.reliability)==null?void 0:A.toFixed(1))||"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Reliability"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-secondary-600","aria-label":`Safety score: ${((L=(M=a.score)==null?void 0:M.safety)==null?void 0:L.toFixed(1))||"N/A"} out of 5`,children:((N=(k=a.score)==null?void 0:k.safety)==null?void 0:N.toFixed(1))||"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Safety"})]})]}),e.jsxs("dl",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Fare:"}),e.jsxs("dd",{className:"font-medium",children:["KES ",a.fare]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Operating Hours:"}),e.jsxs("dd",{className:"font-medium",children:[a.operatingHours.start," - ",a.operatingHours.end]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-gray-600",children:"Stops:"}),e.jsxs("dd",{className:"font-medium",children:[a.stops.length," stops"]})]})]}),e.jsxs("button",{className:"btn btn-primary w-full","aria-label":"View selected route on map",children:[e.jsx(ae,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"View on Map"]})]})})]})]})]})})})}export{xe as default};
//# sourceMappingURL=MapView-sjfQLQF1.js.map
