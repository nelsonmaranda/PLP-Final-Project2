import{a as N,j as e,L as P}from"./index-CRWFIxO4.js";import{r as i}from"./vendor-BKU87Gzz.js";import{b as A}from"./router-hf4IkB-x.js";import{A as T,M as E,n as D,o as M}from"./icons-DFQEmTzF.js";function H(){var g,y,j,v,f;const S=A(),[d,C]=i.useState([]),[l,h]=i.useState(!0),[n,x]=i.useState(!1),[m,t]=i.useState(null),[w,p]=i.useState(!1),[a,c]=i.useState({routeId:"",reportType:"delay",description:"",location:{type:"Point",coordinates:[36.8219,-1.2921]},severity:"medium",isAnonymous:!1});i.useEffect(()=>{b()},[]);const b=async()=>{try{h(!0),t(null);const s=await N.getRoutes({page:1,limit:100,sort:"name",order:"asc"});s.success&&s.data?(C(s.data.routes),console.log(`Loaded ${s.data.routes.length} routes`)):t("Failed to load routes. Please refresh the page and try again.")}catch(s){console.error("Error loading routes:",s),t("Failed to load routes. Please check your connection and try again.")}finally{h(!1)}},o=s=>{const{name:r,value:L,type:R}=s.target;if(R==="checkbox"){const u=s.target.checked;c(I=>({...I,[r]:u}))}else c(u=>({...u,[r]:L}))},F=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{c(r=>({...r,location:{type:"Point",coordinates:[s.coords.longitude,s.coords.latitude]}}))},s=>{console.error("Error getting location:",s),t("Failed to get current location")}):t("Geolocation is not supported by this browser")},k=async s=>{if(s.preventDefault(),!a.routeId){t("Please select a route");return}try{x(!0),t(null);const r=await N.createReport(a);r.success&&r.data?(p(!0),c({routeId:"",reportType:"delay",description:"",location:{type:"Point",coordinates:[36.8219,-1.2921]},severity:"medium",isAnonymous:!1}),console.log("Report submitted successfully!",r.data),setTimeout(()=>p(!1),3e3)):t("Failed to submit report. Please check your information and try again.")}catch(r){console.error("Error submitting report:",r),t("Failed to submit report. Please try again.")}finally{x(!1)}};return l?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading routes..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"container py-6",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h1",{className:"card-title",children:"Report Your Trip"}),e.jsx("p",{className:"card-description",children:"Help other commuters by sharing your matatu experience"})]}),w&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",role:"alert","aria-live":"polite",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Report submitted successfully! Redirecting to map..."})})]})}),m&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",role:"alert","aria-live":"polite",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(T,{className:"h-5 w-5 text-red-400","aria-hidden":"true"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-red-800",children:m})})]}),m.includes("routes")&&e.jsx("button",{type:"button",onClick:b,className:"ml-4 text-sm bg-red-100 hover:bg-red-200 text-red-800 px-3 py-1 rounded",disabled:l,children:"Retry"})]})}),e.jsxs("form",{onSubmit:k,className:"card-content space-y-6","aria-labelledby":"report-form-heading",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"routeId",className:"form-label",children:"Route *"}),e.jsxs("select",{id:"routeId",name:"routeId",value:a.routeId,onChange:o,className:"form-select","aria-describedby":"route-help",required:!0,disabled:l||d.length===0,children:[e.jsx("option",{value:"",children:l?"Loading routes...":d.length===0?"No routes available":"Select a route"}),d.map(s=>e.jsxs("option",{value:s._id,children:[s.routeNumber," - ",s.name," (",s.operator,")"]},s._id))]}),e.jsx("p",{id:"route-help",className:"text-sm text-gray-500 mt-1",children:"Choose the route you want to report on"})]}),e.jsxs("fieldset",{className:"form-group",children:[e.jsx("legend",{className:"form-label",children:"Issue Type *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{value:"delay",label:"Delay",icon:"⏰"},{value:"safety",label:"Safety",icon:"⚠️"},{value:"crowding",label:"Crowding",icon:"👥"},{value:"breakdown",label:"Breakdown",icon:"🔧"},{value:"other",label:"Other",icon:"📝"}].map(s=>e.jsxs("label",{className:"flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"reportType",value:s.value,checked:a.reportType===s.value,onChange:o,className:"mr-3",required:!0}),e.jsx("span",{className:"text-2xl mr-2","aria-hidden":"true",children:s.icon}),e.jsx("span",{className:"font-medium",children:s.label})]},s.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",value:a.description,onChange:o,className:"form-textarea",placeholder:"Describe the issue in detail...",rows:4,maxLength:500,"aria-describedby":"description-help"}),e.jsxs("p",{id:"description-help",className:"mt-1 text-sm text-gray-500",children:[((g=a.description)==null?void 0:g.length)||0,"/500 characters"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"severity",className:"form-label",children:"Severity Level"}),e.jsxs("select",{id:"severity",name:"severity",value:a.severity,onChange:o,className:"form-select","aria-describedby":"severity-help",children:[e.jsx("option",{value:"low",children:"Low - Minor inconvenience"}),e.jsx("option",{value:"medium",children:"Medium - Moderate impact"}),e.jsx("option",{value:"high",children:"High - Significant impact"}),e.jsx("option",{value:"critical",children:"Critical - Safety concern"})]}),e.jsx("p",{id:"severity-help",className:"text-sm text-gray-500 mt-1",children:"Choose the severity level of the issue"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Location"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{type:"button",onClick:F,className:"btn btn-outline btn-sm","aria-label":"Use your current location for the report",children:[e.jsx(E,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Use Current Location"]}),e.jsxs("span",{className:"text-sm text-gray-600","aria-label":`Current coordinates: ${(y=a.location)==null?void 0:y.coordinates[1].toFixed(4)}, ${(j=a.location)==null?void 0:j.coordinates[0].toFixed(4)}`,children:[(v=a.location)==null?void 0:v.coordinates[1].toFixed(4),", ",(f=a.location)==null?void 0:f.coordinates[0].toFixed(4)]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isAnonymous",name:"isAnonymous",checked:a.isAnonymous,onChange:o,className:"rounded border-gray-300","aria-describedby":"anonymous-help"}),e.jsx("label",{htmlFor:"isAnonymous",className:"ml-2 text-sm text-gray-700",children:"Submit anonymously"}),e.jsx("p",{id:"anonymous-help",className:"sr-only",children:"Check this box to submit your report without revealing your identity"})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>S("/map"),className:"btn btn-outline",disabled:n,"aria-label":"Cancel and return to map",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:n,className:"btn btn-primary","aria-label":n?"Submitting report":"Submit your report",children:n?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin","aria-hidden":"true"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Submit Report"]})})]})]})]})})})})}export{H as default};
//# sourceMappingURL=ReportForm-CTRKYf8e.js.map
