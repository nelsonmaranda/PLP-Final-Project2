import{j as e}from"./index-C7slk2iE.js";import{r as l}from"./vendor-BKU87Gzz.js";import{R as p,a3 as L,c as u,a4 as T,a5 as U,f as q,G as z,b as _,w as O,g as f,a6 as N,y as $}from"./icons-B_aqzpWL.js";import"./router-Z6rqMkFf.js";function G(){const[b,c]=l.useState([]),[v,g]=l.useState(!0),[i,S]=l.useState(""),[x,C]=l.useState("all"),[o,k]=l.useState("all"),[m,d]=l.useState(null);l.useEffect(()=>{j()},[]);const j=async()=>{try{g(!0);const s=await fetch("https://us-central1-smart-matwana-ke.cloudfunctions.net/api/admin/users",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to fetch users");const t=await s.json();if(t.success)c(t.data);else throw new Error(t.message||"Failed to load users")}catch(s){console.error("Error loading users:",s),c([])}finally{g(!1)}},R=async s=>{try{d(s);const t=await fetch(`https://us-central1-smart-matwana-ke.cloudfunctions.net/api/admin/users/${s}/approve`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to approve user");const r=await t.json();if(r.success)c(n=>n.map(a=>a._id===s?{...a,role:a.requestedRole||a.role,status:"active",requestedRole:void 0,approvedAt:new Date().toISOString()}:a));else throw new Error(r.message||"Failed to approve user")}catch(t){console.error("Error approving user:",t),alert("Failed to approve user. Please try again.")}finally{d(null)}},A=async(s,t)=>{try{d(s);const r=await fetch(`https://us-central1-smart-matwana-ke.cloudfunctions.net/api/admin/users/${s}/reject`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"},body:JSON.stringify({reason:t})});if(!r.ok)throw new Error("Failed to reject user");const n=await r.json();if(n.success)c(a=>a.map(h=>h._id===s?{...h,status:"rejected",rejectionReason:t,requestedRole:void 0}:h));else throw new Error(n.message||"Failed to reject user")}catch(r){console.error("Error rejecting user:",r),alert("Failed to reject user. Please try again.")}finally{d(null)}},y=s=>{switch(s){case"admin":return e.jsx(O,{className:"w-4 h-4"});case"sacco":return e.jsx(_,{className:"w-4 h-4"});case"authority":return e.jsx(z,{className:"w-4 h-4"});case"moderator":return e.jsx(q,{className:"w-4 h-4"});default:return e.jsx(u,{className:"w-4 h-4"})}},E=s=>{switch(s){case"active":return"text-green-600 bg-green-100";case"pending":return"text-yellow-600 bg-yellow-100";case"suspended":return"text-red-600 bg-red-100";case"rejected":return"text-gray-600 bg-gray-100";default:return"text-gray-600 bg-gray-100"}},F=s=>{switch(s){case"active":return e.jsx($,{className:"w-4 h-4"});case"pending":return e.jsx(f,{className:"w-4 h-4"});case"suspended":return e.jsx(N,{className:"w-4 h-4"});case"rejected":return e.jsx(N,{className:"w-4 h-4"});default:return e.jsx(f,{className:"w-4 h-4"})}},w=b.filter(s=>{var a;const t=s.displayName.toLowerCase().includes(i.toLowerCase())||s.email.toLowerCase().includes(i.toLowerCase())||((a=s.organization)==null?void 0:a.toLowerCase().includes(i.toLowerCase())),r=x==="all"||s.status===x,n=o==="all"||s.role===o||s.requestedRole===o;return t&&r&&n});return v?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading users..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage user roles and permissions"})]}),e.jsxs("button",{onClick:j,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{children:"Refresh"})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:i,onChange:s=>S(s.target.value),placeholder:"Search users...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:x,onChange:s=>C(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"suspended",children:"Suspended"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),e.jsxs("select",{value:o,onChange:s=>k(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"sacco",children:"SACCO"}),e.jsx("option",{value:"authority",children:"Authority"}),e.jsx("option",{value:"moderator",children:"Moderator"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Organization"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(u,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.displayName}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[y(s.role),e.jsx("span",{className:"ml-2 text-sm text-gray-900 capitalize",children:s.role})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.requestedRole?e.jsxs("div",{className:"flex items-center",children:[y(s.requestedRole),e.jsx("span",{className:"ml-2 text-sm text-gray-900 capitalize",children:s.requestedRole})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${E(s.status)}`,children:[F(s.status),e.jsx("span",{className:"ml-1 capitalize",children:s.status})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.organization||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[s.status==="pending"&&s.requestedRole&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>R(s._id),disabled:m===s._id,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[m===s._id?e.jsx(p,{className:"w-3 h-3 animate-spin"}):e.jsx(T,{className:"w-3 h-3"}),e.jsx("span",{className:"ml-1",children:"Approve"})]}),e.jsxs("button",{onClick:()=>{const t=prompt("Rejection reason:");t&&A(s._id,t)},disabled:m===s._id,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-50",children:[e.jsx(U,{className:"w-3 h-3"}),e.jsx("span",{className:"ml-1",children:"Reject"})]})]}),s.status==="active"&&e.jsx("span",{className:"text-green-600 text-xs",children:"Active"})]})]},s._id))})]})})}),w.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(u,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No users found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or filter criteria."})]})]})]})}export{G as default};
//# sourceMappingURL=UserManagement-hS-60pwI.js.map
