{"version":3,"file":"RouteEditor-CNlbIlkN.js","sources":["../../src/screens/RouteEditor.tsx"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react'\r\nimport { Plus, Save, Trash2, ArrowUp, ArrowDown, MapPin, RefreshCw } from 'lucide-react'\r\nimport { MapContainer, TileLayer, Marker, useMapEvents, useMap } from 'react-leaflet'\r\nimport L from 'leaflet'\r\nimport apiService from '../services/api'\r\nimport { RouteWithScores } from '../types'\r\n\r\ninterface StopDraft {\r\n  name: string\r\n  coordinates: [number, number]\r\n}\r\n\r\nexport default function RouteEditor() {\r\n  const [routes, setRoutes] = useState<RouteWithScores[]>([])\r\n  const [selectedRouteId, setSelectedRouteId] = useState('')\r\n  const [stops, setStops] = useState<StopDraft[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [saving, setSaving] = useState(false)\r\n  const [search, setSearch] = useState('')\r\n  const [pickIdx, setPickIdx] = useState<number | null>(null)\r\n  const [picked, setPicked] = useState<[number, number] | null>(null)\r\n  const [searchQuery, setSearchQuery] = useState('')\r\n  const [isGeocoding, setIsGeocoding] = useState(false)\r\n  const [mapCenter, setMapCenter] = useState<[number, number] | null>(null)\r\n\r\n  const tryParseCoords = (q: string): [number, number] | null => {\r\n    const m = q.trim().match(/^\\s*(-?\\d+(?:\\.\\d+)?)\\s*,\\s*(-?\\d+(?:\\.\\d+)?)\\s*$/)\r\n    if (!m) return null\r\n    const a = Number(m[1])\r\n    const b = Number(m[2])\r\n    if (Number.isNaN(a) || Number.isNaN(b)) return null\r\n    // Decide order: if first looks like lat (|a|<=90) and second like lng (|b|<=180), assume \"lat,lng\"\r\n    if (Math.abs(a) <= 90 && Math.abs(b) <= 180) {\r\n      return [b, a] // store as [lng, lat]\r\n    }\r\n    // Else assume given as lng,lat\r\n    return [a, b]\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadRoutes()\r\n  }, [])\r\n\r\n  const loadRoutes = async () => {\r\n    try {\r\n      setLoading(true)\r\n      const resp = await apiService.getRoutes({ page: 1, limit: 200, sort: 'name', order: 'asc' })\r\n      if (resp.success && resp.data) {\r\n        setRoutes(resp.data.routes as any)\r\n      } else {\r\n        setRoutes([])\r\n      }\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    const r = routes.find(rt => String(rt._id) === String(selectedRouteId))\r\n    if (r && Array.isArray(r.stops)) {\r\n      const mapped: StopDraft[] = r.stops.map((s: any) => ({ name: s.name || '', coordinates: [s.coordinates?.[0] ?? 0, s.coordinates?.[1] ?? 0] }))\r\n      setStops(mapped)\r\n    } else {\r\n      setStops([])\r\n    }\r\n  }, [selectedRouteId, routes])\r\n\r\n  const filteredRoutes = useMemo(() => {\r\n    const q = search.toLowerCase()\r\n    return routes.filter(r => `${r.routeNumber || ''} ${r.name}`.toLowerCase().includes(q))\r\n  }, [routes, search])\r\n\r\n  const moveStop = (idx: number, delta: number) => {\r\n    const next = [...stops]\r\n    const swap = idx + delta\r\n    if (swap < 0 || swap >= next.length) return\r\n    const t = next[idx]\r\n    next[idx] = next[swap]\r\n    next[swap] = t\r\n    setStops(next)\r\n  }\r\n\r\n  const updateStop = (idx: number, field: 'name' | 'lng' | 'lat', value: string) => {\r\n    setStops(prev => prev.map((s, i) => {\r\n      if (i !== idx) return s\r\n      if (field === 'name') return { ...s, name: value }\r\n      const [lng, lat] = s.coordinates\r\n      const num = Number(value)\r\n      return field === 'lng' ? { ...s, coordinates: [isNaN(num) ? 0 : num, lat] } : { ...s, coordinates: [lng, isNaN(num) ? 0 : num] }\r\n    }))\r\n  }\r\n\r\n  const addStop = () => {\r\n    setStops(prev => [...prev, { name: 'New Stop', coordinates: [36.8219, -1.2921] }])\r\n  }\r\n\r\n  const removeStop = (idx: number) => {\r\n    setStops(prev => prev.filter((_, i) => i !== idx))\r\n  }\r\n\r\n  const saveStops = async () => {\r\n    if (!selectedRouteId) return\r\n    try {\r\n      setSaving(true)\r\n      const payload = { stops: stops.map(s => ({ name: s.name.trim(), coordinates: s.coordinates })) }\r\n      const resp = await apiService.updateRoute(selectedRouteId, payload as any)\r\n      if (!resp.success) throw new Error('Failed')\r\n      await loadRoutes()\r\n      alert('Stops saved')\r\n    } catch {\r\n      alert('Failed to save')\r\n    } finally {\r\n      setSaving(false)\r\n    }\r\n  }\r\n\r\n  const nairobiCenter: [number, number] = [-1.2921, 36.8219]\r\n\r\n  function ClickPicker({ initial }: { initial: [number, number] }) {\r\n    useMapEvents({\r\n      click(e) {\r\n        setPicked([e.latlng.lng, e.latlng.lat])\r\n      }\r\n    })\r\n    return picked ? <Marker position={[picked[1], picked[0]]} icon={L.icon({\r\n      iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',\r\n      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',\r\n      iconSize: [25, 41], iconAnchor: [12, 41]\r\n    })} /> : <Marker position={[initial[1], initial[0]]} icon={L.icon({\r\n      iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',\r\n      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',\r\n      iconSize: [25, 41], iconAnchor: [12, 41]\r\n    })} />\r\n  }\r\n\r\n  function Recenter({ center }: { center: [number, number] | null }) {\r\n    const map = useMap()\r\n    useEffect(() => {\r\n      if (center) {\r\n        map.flyTo([center[1], center[0]], Math.max(map.getZoom(), 15))\r\n      }\r\n    }, [center, map])\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      <div className=\"bg-white shadow-sm border-b\">\r\n        <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"flex items-center justify-between py-6\">\r\n            <h1 className=\"text-2xl font-bold text-gray-900\">Route Editor</h1>\r\n            <button onClick={loadRoutes} className=\"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\">\r\n              <RefreshCw className=\"w-4 h-4\" /> Refresh\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6 grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n        <div className=\"bg-white rounded-lg shadow p-4 lg:col-span-1\">\r\n          <div className=\"mb-3\">\r\n            <input className=\"form-input w-full\" placeholder=\"Search routes\" value={search} onChange={e=>setSearch(e.target.value)} />\r\n          </div>\r\n          <div className=\"max-h-[520px] overflow-auto divide-y\">\r\n            {loading ? (\r\n              <div className=\"p-4 text-gray-500\">Loading routes...</div>\r\n            ) : (\r\n              filteredRoutes.map(r => (\r\n                <button key={String(r._id)} className={`w-full text-left p-3 hover:bg-gray-50 ${String(r._id)===String(selectedRouteId)?'bg-blue-50':''}`} onClick={()=>setSelectedRouteId(String(r._id))}>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <MapPin className=\"w-4 h-4 text-blue-600\" />\r\n                    <div className=\"truncate\">\r\n                      <div className=\"font-medium text-gray-900 truncate\">{r.routeNumber ? `${r.routeNumber} - ${r.name}` : r.name}</div>\r\n                      <div className=\"text-xs text-gray-500\">{r.stops?.length || 0} stops</div>\r\n                    </div>\r\n                  </div>\r\n                </button>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white rounded-lg shadow p-4 lg:col-span-2\">\r\n          {!selectedRouteId ? (\r\n            <div className=\"text-gray-500\">Select a route to edit its stops.</div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <h2 className=\"text-lg font-semibold\">Stops</h2>\r\n                <div className=\"flex gap-2\">\r\n                  <button className=\"btn btn-outline flex items-center gap-2\" onClick={addStop}><Plus className=\"w-4 h-4\"/>Add Stop</button>\r\n                  <button className=\"btn btn-primary flex items-center gap-2\" disabled={saving} onClick={saveStops}><Save className=\"w-4 h-4\"/>{saving?'Saving...':'Save'}</button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-3\">\r\n                {stops.map((s, idx) => (\r\n                  <div key={idx} className=\"grid grid-cols-12 gap-2 items-center\">\r\n                    <input className=\"form-input col-span-4\" value={s.name} onChange={e=>updateStop(idx,'name',e.target.value)} />\r\n                    <input className=\"form-input col-span-3\" placeholder=\"Longitude\" value={String(s.coordinates[0])} onChange={e=>updateStop(idx,'lng',e.target.value)} />\r\n                    <input className=\"form-input col-span-3\" placeholder=\"Latitude\" value={String(s.coordinates[1])} onChange={e=>updateStop(idx,'lat',e.target.value)} />\r\n                    <div className=\"col-span-2 flex justify-end gap-1\">\r\n                      <button className=\"btn btn-outline\" onClick={()=>{ setPickIdx(idx); setPicked([s.coordinates[0], s.coordinates[1]]) }} title=\"Pick on Map\"><MapPin className=\"w-4 h-4\"/></button>\r\n                      <button className=\"btn btn-outline\" onClick={()=>moveStop(idx,-1)} title=\"Move up\"><ArrowUp className=\"w-4 h-4\"/></button>\r\n                      <button className=\"btn btn-outline\" onClick={()=>moveStop(idx,1)} title=\"Move down\"><ArrowDown className=\"w-4 h-4\"/></button>\r\n                      <button className=\"btn btn-outline\" onClick={()=>removeStop(idx)} title=\"Remove\"><Trash2 className=\"w-4 h-4 text-red-600\"/></button>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Map picker modal */}\r\n      {pickIdx !== null && (\r\n        <div className=\"fixed inset-0 bg-black/30 flex items-center justify-center p-4 z-50\">\r\n          <div className=\"bg-white rounded-lg shadow-lg w-full max-w-3xl p-4\">\r\n            <h3 className=\"text-lg font-semibold mb-3\">Click on the map to set coordinates</h3>\r\n            <div style={{ height: 420 }} className=\"rounded overflow-hidden\">\r\n              <MapContainer center={[stops[pickIdx]?.coordinates?.[1] ?? nairobiCenter[0], stops[pickIdx]?.coordinates?.[0] ?? nairobiCenter[1]]} zoom={13} style={{ height: '100%', width: '100%' }}>\r\n                <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" attribution='&copy; OpenStreetMap contributors' />\r\n                <Recenter center={mapCenter} />\r\n                <ClickPicker initial={[stops[pickIdx]?.coordinates?.[0] ?? nairobiCenter[1], stops[pickIdx]?.coordinates?.[1] ?? nairobiCenter[0]]} />\r\n              </MapContainer>\r\n            </div>\r\n            <div className=\"mt-3 grid grid-cols-1 md:grid-cols-3 gap-2 items-center\">\r\n              <div className=\"text-sm text-gray-600 md:col-span-1\">Picked: {picked ? `${picked[0].toFixed(6)}, ${picked[1].toFixed(6)}` : `${stops[pickIdx].coordinates[0]}, ${stops[pickIdx].coordinates[1]}`}</div>\r\n              <div className=\"flex items-center gap-2 md:col-span-1\">\r\n                <input\r\n                  className=\"form-input w-full\"\r\n                  placeholder=\"Search place or stop name\"\r\n                  value={searchQuery}\r\n                  onChange={e => setSearchQuery(e.target.value)}\r\n                  onKeyDown={async e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault()\r\n                      setIsGeocoding(true)\r\n                      try {\r\n                        const parsed = tryParseCoords(searchQuery)\r\n                        if (parsed) {\r\n                          setMapCenter(parsed)\r\n                          setPicked(parsed)\r\n                        } else {\r\n                          const r = await apiService.geocodeAddress(searchQuery)\r\n                          if (r.success && r.data) {\r\n                            const lnglat: [number, number] = [r.data.lng, r.data.lat]\r\n                            setMapCenter(lnglat)\r\n                            setPicked(lnglat)\r\n                          }\r\n                        }\r\n                      } catch {}\r\n                      finally { setIsGeocoding(false) }\r\n                    }\r\n                  }}\r\n                />\r\n                <button\r\n                  className=\"btn btn-outline\"\r\n                  disabled={isGeocoding}\r\n                  onClick={async () => {\r\n                    setIsGeocoding(true)\r\n                    try {\r\n                      const parsed = tryParseCoords(searchQuery)\r\n                      if (parsed) {\r\n                        setMapCenter(parsed)\r\n                        setPicked(parsed)\r\n                      } else {\r\n                        const r = await apiService.geocodeAddress(searchQuery)\r\n                        if (r.success && r.data) {\r\n                          const lnglat: [number, number] = [r.data.lng, r.data.lat]\r\n                          setMapCenter(lnglat)\r\n                          setPicked(lnglat)\r\n                        }\r\n                      }\r\n                    } catch {}\r\n                    finally { setIsGeocoding(false) }\r\n                  }}\r\n                >\r\n                  {isGeocoding ? 'Searching…' : 'Search'}\r\n                </button>\r\n              </div>\r\n              <div className=\"flex justify-end gap-2 md:col-span-1\">\r\n                <button className=\"btn btn-outline\" onClick={()=>{ setPickIdx(null); setPicked(null); setSearchQuery(''); setMapCenter(null) }}>Cancel</button>\r\n                <button className=\"btn btn-outline\" disabled={!picked} title=\"Apply the geocoded result to this stop\" onClick={()=>{ if(!picked) return; const target = picked as [number,number]; updateStop(pickIdx!,'lng', String(target[0])); updateStop(pickIdx!,'lat', String(target[1])); }}>Apply search result</button>\r\n                <button className=\"btn btn-primary\" onClick={()=>{ const target = picked ?? stops[pickIdx!].coordinates as [number,number]; updateStop(pickIdx!,'lng', String(target[0])); updateStop(pickIdx!,'lat', String(target[1])); setPickIdx(null); setPicked(null); setSearchQuery(''); setMapCenter(null) }}>Use pinned location</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\n\r\n"],"names":["RouteEditor","routes","setRoutes","useState","selectedRouteId","setSelectedRouteId","stops","setStops","loading","setLoading","saving","setSaving","search","setSearch","pickIdx","setPickIdx","picked","setPicked","searchQuery","setSearchQuery","isGeocoding","setIsGeocoding","mapCenter","setMapCenter","tryParseCoords","q","m","b","useEffect","loadRoutes","resp","apiService","r","rt","mapped","s","_a","_b","filteredRoutes","useMemo","moveStop","idx","delta","next","swap","t","updateStop","field","value","prev","i","lng","lat","num","addStop","removeStop","_","saveStops","payload","nairobiCenter","ClickPicker","initial","useMapEvents","e","jsx","Marker","L","Recenter","center","map","useMap","jsxs","RefreshCw","MapPin","Plus","Save","ArrowUp","ArrowDown","Trash2","MapContainer","_d","_c","TileLayer","_f","_e","_h","_g","parsed","lnglat","target"],"mappings":"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"}