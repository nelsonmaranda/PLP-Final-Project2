import{u as B,j as e,a as A}from"./index-C3Iv6a33.js";import{r}from"./vendor-BKU87Gzz.js";import{R as v,J as I,a4 as D,c as b,a5 as G,a6 as J,a7 as X,f as H,G as K,b as Q,w as V,g as z,a8 as F,y as W}from"./icons-laTIaZ17.js";import"./router-Z6rqMkFf.js";function se(){const{t:c}=B(),[E,x]=r.useState([]),[U,C]=r.useState(!0),[u,T]=r.useState(""),[j,M]=r.useState("all"),[p,L]=r.useState("all"),[f,h]=r.useState(null),[O,y]=r.useState(!1),[t,o]=r.useState({displayName:"",email:"",password:"",role:"user",organization:""}),[S,w]=r.useState(null),[l,d]=r.useState({displayName:"",email:"",role:"user",status:"active",organization:""});r.useEffect(()=>{g()},[]);const g=async()=>{try{C(!0);const a=await fetch("https://us-central1-smart-matwana-ke.cloudfunctions.net/api/admin/users",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}});if(!a.ok)throw new Error("Failed to fetch users");const s=await a.json();if(s.success)x(s.data);else throw new Error(s.message||"Failed to load users")}catch(a){console.error("Error loading users:",a),x([])}finally{C(!1)}},q=async a=>{try{h(a);const s=await fetch(`https://us-central1-smart-matwana-ke.cloudfunctions.net/api/admin/users/${a}/approve`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to approve user");const i=await s.json();if(i.success)x(m=>m.map(n=>n._id===a?{...n,role:n.requestedRole||n.role,status:"active",requestedRole:void 0,approvedAt:new Date().toISOString()}:n));else throw new Error(i.message||"Failed to approve user")}catch(s){console.error("Error approving user:",s),alert("Failed to approve user. Please try again.")}finally{h(null)}},_=async(a,s)=>{try{h(a);const i=await fetch(`https://us-central1-smart-matwana-ke.cloudfunctions.net/api/admin/users/${a}/reject`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"},body:JSON.stringify({reason:s})});if(!i.ok)throw new Error("Failed to reject user");const m=await i.json();if(m.success)x(n=>n.map(N=>N._id===a?{...N,status:"rejected",rejectionReason:s,requestedRole:void 0}:N));else throw new Error(m.message||"Failed to reject user")}catch(i){console.error("Error rejecting user:",i),alert("Failed to reject user. Please try again.")}finally{h(null)}},k=a=>{switch(a){case"admin":return e.jsx(V,{className:"w-4 h-4"});case"sacco":return e.jsx(Q,{className:"w-4 h-4"});case"authority":return e.jsx(K,{className:"w-4 h-4"});case"moderator":return e.jsx(H,{className:"w-4 h-4"});default:return e.jsx(b,{className:"w-4 h-4"})}},P=a=>{switch(a){case"active":return"text-green-600 bg-green-100";case"pending":return"text-yellow-600 bg-yellow-100";case"suspended":return"text-red-600 bg-red-100";case"rejected":return"text-gray-600 bg-gray-100";default:return"text-gray-600 bg-gray-100"}},$=a=>{switch(a){case"active":return e.jsx(W,{className:"w-4 h-4"});case"pending":return e.jsx(z,{className:"w-4 h-4"});case"suspended":return e.jsx(F,{className:"w-4 h-4"});case"rejected":return e.jsx(F,{className:"w-4 h-4"});default:return e.jsx(z,{className:"w-4 h-4"})}},R=E.filter(a=>{var n;const s=a.displayName.toLowerCase().includes(u.toLowerCase())||a.email.toLowerCase().includes(u.toLowerCase())||((n=a.organization)==null?void 0:n.toLowerCase().includes(u.toLowerCase())),i=j==="all"||a.status===j,m=p==="all"||a.role===p||a.requestedRole===p;return s&&i&&m});return U?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:c("userManagement.loading")})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:c("userManagement.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:c("userManagement.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:g,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{children:"Refresh"})]}),e.jsxs("button",{onClick:()=>y(!0),className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:"Add User"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:u,onChange:a=>T(a.target.value),placeholder:"Search users...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:j,onChange:a=>M(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"suspended",children:"Suspended"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),e.jsxs("select",{value:p,onChange:a=>L(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"sacco",children:"SACCO"}),e.jsx("option",{value:"authority",children:"Authority"}),e.jsx("option",{value:"moderator",children:"Moderator"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:c("userManagement.table.displayName")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:c("userManagement.table.role")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Requested Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:c("userManagement.table.status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Organization"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:c("userManagement.table.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:R.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(b,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.displayName}),e.jsx("div",{className:"text-sm text-gray-500",children:a.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[k(a.role),e.jsx("span",{className:"ml-2 text-sm text-gray-900 capitalize",children:a.role})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.requestedRole?e.jsxs("div",{className:"flex items-center",children:[k(a.requestedRole),e.jsx("span",{className:"ml-2 text-sm text-gray-900 capitalize",children:a.requestedRole})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${P(a.status)}`,children:[$(a.status),e.jsx("span",{className:"ml-1 capitalize",children:a.status})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a.organization||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(a.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[a.status==="pending"&&a.requestedRole&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>q(a._id),disabled:f===a._id,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[f===a._id?e.jsx(v,{className:"w-3 h-3 animate-spin"}):e.jsx(G,{className:"w-3 h-3"}),e.jsx("span",{className:"ml-1",children:"Approve"})]}),e.jsxs("button",{onClick:()=>{const s=prompt("Rejection reason:");s&&_(a._id,s)},disabled:f===a._id,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-50",children:[e.jsx(J,{className:"w-3 h-3"}),e.jsx("span",{className:"ml-1",children:"Reject"})]})]}),e.jsxs("button",{onClick:()=>{w(a._id),d({displayName:a.displayName,email:a.email,role:a.role,status:a.status,organization:a.organization||""})},className:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 ml-2",children:[e.jsx(X,{className:"w-3 h-3 mr-1"})," Edit"]})]})]},a._id))})]})})}),R.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No users found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or filter criteria."})]})]}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add User"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"form-input w-full",placeholder:"Full name",value:t.displayName,onChange:a=>o({...t,displayName:a.target.value})}),e.jsx("input",{className:"form-input w-full",placeholder:"Email",value:t.email,onChange:a=>o({...t,email:a.target.value})}),e.jsx("input",{className:"form-input w-full",placeholder:"Temporary password",type:"password",value:t.password,onChange:a=>o({...t,password:a.target.value})}),e.jsxs("select",{className:"form-select w-full",value:t.role,onChange:a=>o({...t,role:a.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"sacco",children:"SACCO"}),e.jsx("option",{value:"authority",children:"Authority"}),e.jsx("option",{value:"moderator",children:"Moderator"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsx("input",{className:"form-input w-full",placeholder:"Organization (optional)",value:t.organization,onChange:a=>o({...t,organization:a.target.value})})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{try{(await A.adminCreateUser(t)).success&&(y(!1),o({displayName:"",email:"",password:"",role:"user",organization:""}),g())}catch{alert("Failed to create user")}},children:"Create"})]})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Edit User"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"form-input w-full",placeholder:"Full name",value:l.displayName,onChange:a=>d({...l,displayName:a.target.value})}),e.jsx("input",{className:"form-input w-full",placeholder:"Email",value:l.email,onChange:a=>d({...l,email:a.target.value})}),e.jsxs("select",{className:"form-select w-full",value:l.role,onChange:a=>d({...l,role:a.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"sacco",children:"SACCO"}),e.jsx("option",{value:"authority",children:"Authority"}),e.jsx("option",{value:"moderator",children:"Moderator"}),e.jsx("option",{value:"admin",children:"Admin"})]}),e.jsxs("select",{className:"form-select w-full",value:l.status,onChange:a=>d({...l,status:a.target.value}),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"suspended",children:"Suspended"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsx("input",{className:"form-input w-full",placeholder:"Organization (optional)",value:l.organization,onChange:a=>d({...l,organization:a.target.value})})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>w(null),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{try{(await A.adminUpdateUser(S,l)).success&&(w(null),g())}catch{alert("Failed to update user")}},children:"Save"})]})]})})]})}export{se as default};
//# sourceMappingURL=UserManagement-CL4UlCfI.js.map
