import{u as ae,b as te,a as o,j as e}from"./index-DYoPkzMu.js";import{r}from"./vendor-BKU87Gzz.js";import{L as p}from"./router-Z6rqMkFf.js";import{U as w,x as re,e as R,d as C,B as le,A as ie,y as ne,z as ce,X as q,R as S,M as oe,g as B,k as de}from"./icons-laTIaZ17.js";function he(){var M,$,z;const{t:a}=ae(),{state:t,setUser:k}=te(),[n,H]=r.useState("profile"),[h,f]=r.useState(!1),[E,F]=r.useState(!1),[I,g]=r.useState(null),[K,j]=r.useState(!1),[b,V]=r.useState({displayName:((M=t.user)==null?void 0:M.displayName)||"",email:(($=t.user)==null?void 0:$.email)||""}),[X,L]=r.useState(!1),[U,Y]=r.useState(((z=t.user)==null?void 0:z.avatarUrl)||null),[A,G]=r.useState([]),[N,P]=r.useState(!1),[T,J]=r.useState([]),[y,_]=r.useState(!1),[d,O]=r.useState({totalReports:0,reportsThisMonth:0,favoriteRoutesCount:0,averageRating:0,mostReportedRoute:null}),m=r.useCallback(async()=>{if(t.user){P(!0);try{const s=await o.getUserReports(t.user._id);s.success&&s.data&&G(s.data.reports||[])}catch(s){console.error("Error loading reports:",s)}finally{P(!1)}}},[t.user]),c=r.useCallback(async()=>{if(t.user){_(!0);try{const s=await o.getFavoriteRoutes(t.user._id);s.success&&s.data&&J(s.data.routes||[])}catch(s){console.error("Error loading favorites:",s)}finally{_(!1)}}},[t.user]),x=r.useCallback(async()=>{if(t.user)try{const s=await o.getUserAnalytics(t.user._id);s.success&&s.data&&O(s.data)}catch(s){console.error("Error loading analytics:",s)}},[t.user]),Q=r.useCallback(async s=>{if(t.user)try{(await o.removeFavoriteRoute(t.user._id,s)).success&&c()}catch(l){console.error("Error removing favorite:",l)}},[t.user,c]);r.useEffect(()=>{t.user&&(m(),c(),x())},[t.user,m,c,x]),r.useEffect(()=>{if(t.user)switch(n){case"reports":m();break;case"favorites":c();break;case"analytics":x();break}},[n,t.user,m,c,x]);const W=async s=>{if(s.preventDefault(),!!t.user){F(!0),g(null),j(!1);try{const l=await o.updateProfile(t.user._id,b);l.success&&l.data?(k(l.data.user),j(!0),f(!1),setTimeout(()=>j(!1),3e3)):g(a("profile.updateError"))}catch(l){console.error("Profile update error:",l),g(a("profile.updateError"))}finally{F(!1)}}},Z=async s=>{var u;if(!s.target.files||s.target.files.length===0)return;const l=s.target.files[0];try{L(!0);const i=await o.uploadFile(l,"profile");if(i!=null&&i.success&&((u=i==null?void 0:i.data)!=null&&u.url)){const v=i.data.url;Y(v),await o.updateProfile(t.user._id,{displayName:t.user.displayName,email:t.user.email,avatarUrl:v}),k({...t.user,avatarUrl:v})}}catch(i){console.error("Upload failed",i)}finally{L(!1)}},D=s=>{const{name:l,value:u}=s.target;V(i=>({...i,[l]:u}))},ee=s=>new Date(s).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),se=s=>{switch(s){case"low":return"text-green-600 bg-green-100";case"medium":return"text-yellow-600 bg-yellow-100";case"high":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};return t.user?e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"px-6 py-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-primary-500 flex items-center justify-center",children:U?e.jsx("img",{src:U,alt:"Avatar",className:"w-16 h-16 object-cover"}):e.jsx(w,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.user.displayName}),e.jsx("p",{className:"text-gray-600",children:t.user.email}),e.jsxs("p",{className:"text-sm text-gray-500 capitalize",children:[a("profile.role"),": ",t.user.role]})]}),e.jsxs("button",{onClick:()=>f(!h),className:"btn btn-ghost btn-sm",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),a(h?"common.cancel":"profile.personalInfo.editProfile")]}),e.jsx("div",{className:"ml-4",children:e.jsxs("label",{className:"btn btn-outline btn-sm cursor-pointer",children:[a(X?"profile.personalInfo.uploading":"profile.personalInfo.uploadPhoto"),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:Z})]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-8 px-6",children:[{id:"profile",name:a("profile.tabs.personal"),icon:w},{id:"reports",name:a("profile.tabs.reports"),icon:R},{id:"favorites",name:a("profile.tabs.favorites"),icon:C},{id:"analytics",name:a("profile.tabs.analytics"),icon:le}].map(s=>{const l=s.icon;return e.jsxs("button",{onClick:()=>H(s.id),className:`py-4 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ${n===s.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(l,{className:"w-4 h-4"}),e.jsx("span",{children:s.name})]},s.id)})})}),e.jsxs("div",{className:"p-6",children:[n==="profile"&&e.jsx("div",{children:h?e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[I&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsx("p",{className:"text-sm text-red-800",children:I})]})}),K&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"h-5 w-5 text-green-400 mr-2"}),e.jsx("p",{className:"text-sm text-green-800",children:"Profile updated successfully!"})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"displayName",className:"block text-sm font-medium text-gray-700 mb-1",children:a("profile.personalInfo.displayName")}),e.jsx("input",{type:"text",id:"displayName",name:"displayName",value:b.displayName,onChange:D,className:"input w-full",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:a("profile.personalInfo.email")}),e.jsx("input",{type:"email",id:"email",name:"email",value:b.email,onChange:D,className:"input w-full",required:!0})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:E,className:"btn btn-primary",children:E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Save Changes"]})}),e.jsxs("button",{type:"button",onClick:()=>f(!1),className:"btn btn-ghost",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:a("profile.accountInformation")}),e.jsxs("dl",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:a("profile.personalInfo.displayName")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.user.displayName})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:a("profile.personalInfo.email")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:t.user.email})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:a("profile.accountType")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 capitalize",children:t.user.role})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:a("profile.memberSince")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900",children:new Date(t.user.createdAt||Date.now()).toLocaleDateString("en-KE")})]})]})]})})}),n==="reports"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:a("profile.myTripReports")}),e.jsxs("button",{onClick:m,disabled:N,className:"flex items-center space-x-2 px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 disabled:opacity-50",children:[e.jsx(S,{className:`w-4 h-4 ${N?"animate-spin":""}`}),e.jsx("span",{children:a("profile.refresh")})]})]}),N?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):A.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:a("profile.noReportsYet")}),e.jsx(p,{to:"/report",className:"btn btn-primary",children:a("profile.submitFirstReport")})]}):e.jsx("div",{className:"space-y-4",children:A.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["Route ",s.routeId]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${se(s.severity)}`,children:s.severity})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),ee(s.createdAt)]}),e.jsxs("span",{className:"capitalize",children:["Type: ",s.reportType]})]})]})})},s._id))})]}),n==="favorites"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:a("profile.favoriteRoutes")}),e.jsxs("button",{onClick:c,disabled:y,className:"flex items-center space-x-2 px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 disabled:opacity-50",children:[e.jsx(S,{className:`w-4 h-4 ${y?"animate-spin":""}`}),e.jsx("span",{children:a("profile.refresh")})]})]}),y?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})}):T.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(C,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:a("profile.noFavoriteRoutes")}),e.jsx(p,{to:"/map",className:"btn btn-primary",children:a("profile.exploreRoutes")})]}):e.jsx("div",{className:"space-y-4",children:T.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.operator}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Route ",s.routeNumber]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{to:`/map?route=${s._id}`,className:"btn btn-ghost btn-sm",children:"View"}),e.jsx("button",{onClick:()=>Q(s._id),className:"btn btn-ghost btn-sm text-red-600 hover:text-red-700",children:e.jsx(q,{className:"w-4 h-4"})})]})]})},s._id))})]}),n==="analytics"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:a("profile.yourAnalytics")}),e.jsxs("button",{onClick:x,className:"flex items-center space-x-2 px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:a("profile.refresh")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:a("profile.totalReports")}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:d.totalReports})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:a("profile.thisMonth")}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:d.reportsThisMonth})]})]})}),e.jsx("div",{className:"bg-purple-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:a("profile.favorites")}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:d.favoriteRoutesCount})]})]})}),e.jsx("div",{className:"bg-yellow-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(de,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:a("profile.avgRating")}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:d.averageRating.toFixed(1)})]})]})})]}),d.mostReportedRoute&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Most Reported Route"}),e.jsx("p",{className:"text-sm text-gray-600",children:d.mostReportedRoute})]})]})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:a("profile.pleaseLogin")}),e.jsx("p",{className:"text-gray-600 mb-4",children:a("profile.loginRequired")}),e.jsx(p,{to:"/login",className:"btn btn-primary",children:a("profile.goToLogin")})]})})}export{he as default};
//# sourceMappingURL=Profile-7x7nMTIZ.js.map
