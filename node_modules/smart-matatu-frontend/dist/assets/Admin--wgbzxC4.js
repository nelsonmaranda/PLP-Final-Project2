import{u as O,b as J,j as e,a as d}from"./index-BBcuCBxx.js";import{r as o}from"./vendor-BKU87Gzz.js";import{L as K}from"./router-BF-yxxER.js";import{M as S,B as U,d as q,A as Q,r as V,I as W,J as X,K as Y,O as G,Q as H,E as Z,V as ee,Y as se}from"./icons-l6XdvyrE.js";function ce(){var C;const{t:a}=O(),{state:A}=J(),N=((C=A.user)==null?void 0:C.role)==="admin",[$,m]=o.useState(!0),[h,p]=o.useState([]),[P,_]=o.useState(0),[R,g]=o.useState([]),[T,f]=o.useState(!1),[j,v]=o.useState({name:"",description:""}),[b,w]=o.useState(!1),[k,u]=o.useState("");o.useEffect(()=>{const s=async()=>{try{m(!0);const r=await d.getRoutes({page:1,limit:100,sort:"createdAt",order:"desc"});r.success&&r.data?p(r.data.routes):p([])}catch(r){console.error("Failed to load routes",r),p([])}finally{m(!1)}},t=async()=>{var r;try{const i=await(await fetch("https://us-central1-smart-matwana-ke.cloudfunctions.net/api/reports/count")).json();i!=null&&i.success&&typeof((r=i==null?void 0:i.data)==null?void 0:r.count)=="number"&&_(i.data.count)}catch{}},n=async()=>{var r;try{const c=localStorage.getItem("authToken");if(!c)return;const x=await(await fetch("https://us-central1-smart-matwana-ke.cloudfunctions.net/api/reports?page=1&limit=20&sort=createdAt&order=desc&status=pending",{headers:{Authorization:`Bearer ${c}`}})).json();x!=null&&x.success&&g(((r=x.data)==null?void 0:r.reports)||[])}catch(c){console.error("Failed to load pending reports",c),g([])}};s(),t(),n()},[]);const B=async()=>{try{if(j.name.trim()){m(!0);const s=await d.createRoute({name:j.name,description:j.description});if(s.success&&s.data){const t=await d.getRoutes({page:1,limit:100,sort:"createdAt",order:"desc"});p(t.success&&t.data?t.data.routes:[]),v({name:"",description:""}),f(!1)}}}catch(s){console.error("Failed to add route",s)}finally{m(!1)}},D=async s=>{try{m(!0),await d.deleteRoute(s);const t=await d.getRoutes({page:1,limit:100,sort:"createdAt",order:"desc"});p(t.success&&t.data?t.data.routes:[])}catch(t){console.error("Failed to delete route",t)}finally{m(!1)}},E=async s=>{try{m(!0);const t=h.find(c=>c._id===s||c.id===s);if(!t)return;const n=t.status==="active"?"inactive":"active";await d.updateRoute(t._id||t.id,{status:n});const r=await d.getRoutes({page:1,limit:100,sort:"createdAt",order:"desc"});p(r.success&&r.data?r.data.routes:[])}catch(t){console.error("Failed to toggle route status",t)}finally{m(!1)}},I=async s=>{try{await d.approveReport(s),g(t=>t.filter(n=>n._id!==s))}catch(t){console.error("Approve report failed",t)}},F=async s=>{try{await d.resolveReport(s),g(t=>t.filter(n=>n._id!==s))}catch(t){console.error("Resolve report failed",t)}},L=async s=>{try{await d.dismissReport(s),g(t=>t.filter(n=>n._id!==s))}catch(t){console.error("Dismiss report failed",t)}},M=[{title:a("admin.stats.totalRoutes"),value:h.length,icon:S,color:"text-blue-600",bgColor:"bg-blue-100"},{title:a("admin.stats.activeRoutes"),value:h.length,icon:U,color:"text-green-600",bgColor:"bg-green-100"},{title:a("admin.stats.totalReports"),value:P,icon:q,color:"text-purple-600",bgColor:"bg-purple-100"},{title:a("admin.stats.safetyIssues"),value:h.reduce((s,t)=>s+(t.safetyIssues||0),0),icon:Q,color:"text-red-600",bgColor:"bg-red-100"}],z=async()=>{var s;w(!0),u("");try{let t=[];try{const i=await fetch("/scripts/seed-routes.json");i.ok&&(t=await i.json())}catch{}(!t||t.length===0)&&(t=[{name:"Route 46 - CBD to Westlands",routeNumber:"46"},{name:"Route 44 - CBD to Kasarani",routeNumber:"44"},{name:"Route 58 - CBD to Embakasi",routeNumber:"58"}]);const n=localStorage.getItem("authToken");if(!n){u("Missing auth token. Please login again."),w(!1);return}let r=0;for(let i=0;i<t.length;i+=10){const x=t.slice(i,i+10),l=await(await fetch("https://us-central1-smart-matwana-ke.cloudfunctions.net/api/admin/seed/routes",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({routes:x})})).json();l!=null&&l.success&&((s=l==null?void 0:l.data)==null?void 0:s.created)>=0?(r+=l.data.created,u(y=>`${y}
Chunk ${i}-${i+x.length-1}: created ${l.data.created}`)):u(y=>`${y}
Chunk ${i}-${i+x.length-1}: failed (${(l==null?void 0:l.message)||"unknown"})`),await new Promise(y=>setTimeout(y,250))}const c=await d.getRoutes({page:1,limit:100,sort:"createdAt",order:"desc"});p(c.success&&c.data?c.data.routes:[]),u(i=>`${i}
Total created: ${r}`)}catch(t){u(`Seed failed: ${(t==null?void 0:t.message)||t}`)}finally{w(!1)}};return $?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"loading-spinner mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:a("admin.loading")})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container py-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:a("admin.title")}),e.jsx("p",{className:"text-gray-600 mt-2",children:a("admin.subtitle")})]}),N&&e.jsxs("div",{className:"card mb-6",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"card-title",children:a("admin.seedRoutes")}),e.jsxs("button",{onClick:z,disabled:b,className:"btn btn-primary btn-sm",children:[b?e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(W,{className:"w-4 h-4 mr-2"}),a(b?"admin.seeding":"admin.runSeed")]})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:a("admin.seedDescription")}),k&&e.jsx("pre",{className:"mt-3 whitespace-pre-wrap text-xs bg-gray-50 p-3 rounded border border-gray-200",children:k})]})]}),N&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:e.jsx(K,{to:"/admin/routes",className:"card hover:bg-gray-50",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-indigo-100",children:e.jsx(S,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a("admin.tools")}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:a("admin.routeEditor")})]})]})})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:M.map((s,t)=>{const n=s.icon;return e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-3 rounded-lg ${s.bgColor}`,children:e.jsx(n,{className:`w-6 h-6 ${s.color}`})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.value})]})]})})},t)})}),N&&e.jsxs("div",{className:"card mb-8",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"card-title",children:a("admin.pendingReports")||"Pending Reports"})}),e.jsx("div",{className:"card-content p-0",children:R.length===0?e.jsx("div",{className:"p-6 text-sm text-gray-600",children:a("admin.noPendingReports")||"No pending reports"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.report")||"Report"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.route")||"Route"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.severity")||"Severity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.actions")||"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:R.map(s=>{var t;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:s.description||s.reportType}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:((t=s.routeId)==null?void 0:t.name)||s.routeId||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm capitalize",children:s.severity}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsxs("button",{onClick:()=>I(s._id),className:"inline-flex items-center text-green-600 hover:text-green-800",children:[e.jsx(X,{className:"w-4 h-4 mr-1"})," ",a("admin.approve")||"Approve"]}),e.jsxs("button",{onClick:()=>F(s._id),className:"inline-flex items-center text-blue-600 hover:text-blue-800",children:[e.jsx(Y,{className:"w-4 h-4 mr-1"})," ",a("admin.resolve")||"Resolve"]}),e.jsxs("button",{onClick:()=>L(s._id),className:"inline-flex items-center text-red-600 hover:text-red-800",children:[e.jsx(G,{className:"w-4 h-4 mr-1"})," ",a("admin.dismiss")||"Dismiss"]})]})]},s._id)})})]})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"card-title",children:a("admin.routeManagement")}),e.jsxs("button",{onClick:()=>f(!0),className:"btn btn-primary btn-sm",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),a("admin.addRoute")]})]})}),e.jsxs("div",{className:"card-content p-0",children:[T&&e.jsxs("div",{className:"border-b border-gray-200 p-6 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:a("admin.addNewRoute")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:a("admin.routeName")}),e.jsx("input",{type:"text",value:j.name,onChange:s=>v(t=>({...t,name:s.target.value})),className:"form-input",placeholder:a("admin.routeNamePlaceholder")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:a("admin.description")}),e.jsx("input",{type:"text",value:j.description,onChange:s=>v(t=>({...t,description:s.target.value})),className:"form-input",placeholder:a("admin.descriptionPlaceholder")})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>f(!1),className:"btn btn-outline",children:a("admin.cancel")}),e.jsx("button",{onClick:B,className:"btn btn-primary",children:a("admin.addRoute")})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.route")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.reliability")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.safety")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.reports")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:a("admin.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(s=>{var t,n,r,c;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-gray-900",children:((t=s.score)==null?void 0:t.reliability)??"-"}),e.jsx("div",{className:"ml-2 w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${(((n=s.score)==null?void 0:n.reliability)??0)/5*100}%`}})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm text-gray-900",children:((r=s.score)==null?void 0:r.safety)??"-"}),e.jsx("div",{className:"ml-2 w-16 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${(((c=s.score)==null?void 0:c.safety)??0)/5*100}%`}})})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.reportsCount??0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(s.status||"active")==="active"?"bg-green-100 text-green-800":(s.status||"inactive")==="maintenance"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:a(`admin.status.${s.status||"active"}`)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-900",children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-gray-600 hover:text-gray-900",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>E(s._id||s.id),className:"text-green-600 hover:text-green-900",children:(s.status||"active")==="active"?a("admin.deactivate"):a("admin.activate")}),e.jsx("button",{onClick:()=>D(s._id||s.id),className:"text-red-600 hover:text-red-900",children:e.jsx(se,{className:"w-4 h-4"})})]})})]},s._id||s.id)})})]})})]})]})]})})}export{ce as default};
//# sourceMappingURL=Admin--wgbzxC4.js.map
