import{u as D,j as e,a as R}from"./index-CZ1xp9sy.js";import{r as l}from"./vendor-BKU87Gzz.js";import{R as v,J as G,a4 as J,c as b,a5 as X,a6 as H,a7 as K,f as Q,G as V,b as W,w as Y,g as z,a8 as E,y as Z}from"./icons-laTIaZ17.js";import"./router-Z6rqMkFf.js";function re(){const{t:s}=D(),[F,u]=l.useState([]),[T,M]=l.useState(!0),[x,L]=l.useState(""),[j,q]=l.useState("all"),[g,_]=l.useState("all"),[f,h]=l.useState(null),[A,w]=l.useState(!1),[r,c]=l.useState({displayName:"",email:"",password:"",role:"user",organization:""}),[C,y]=l.useState(null),[n,d]=l.useState({displayName:"",email:"",role:"user",status:"active",organization:""});l.useEffect(()=>{p()},[]);const p=async()=>{try{M(!0);const a=await fetch("https://us-central1-smart-matwana-ke.cloudfunctions.net/api/admin/users",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}});if(!a.ok)throw new Error("Failed to fetch users");const t=await a.json();if(t.success)u(t.data);else throw new Error(t.message||"Failed to load users")}catch(a){console.error("Error loading users:",a),u([])}finally{M(!1)}},P=async a=>{try{h(a);const t=await fetch(`https://us-central1-smart-matwana-ke.cloudfunctions.net/api/admin/users/${a}/approve`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to approve user");const o=await t.json();if(o.success)u(m=>m.map(i=>i._id===a?{...i,role:i.requestedRole||i.role,status:"active",requestedRole:void 0,approvedAt:new Date().toISOString()}:i));else throw new Error(o.message||"Failed to approve user")}catch(t){console.error("Error approving user:",t),alert("Failed to approve user. Please try again.")}finally{h(null)}},$=async(a,t)=>{try{h(a);const o=await fetch(`https://us-central1-smart-matwana-ke.cloudfunctions.net/api/admin/users/${a}/reject`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"},body:JSON.stringify({reason:t})});if(!o.ok)throw new Error("Failed to reject user");const m=await o.json();if(m.success)u(i=>i.map(N=>N._id===a?{...N,status:"rejected",rejectionReason:t,requestedRole:void 0}:N));else throw new Error(m.message||"Failed to reject user")}catch(o){console.error("Error rejecting user:",o),alert("Failed to reject user. Please try again.")}finally{h(null)}},k=a=>{switch(a){case"admin":return e.jsx(Y,{className:"w-4 h-4"});case"sacco":return e.jsx(W,{className:"w-4 h-4"});case"authority":return e.jsx(V,{className:"w-4 h-4"});case"moderator":return e.jsx(Q,{className:"w-4 h-4"});default:return e.jsx(b,{className:"w-4 h-4"})}},B=a=>{switch(a){case"active":return"text-green-600 bg-green-100";case"pending":return"text-yellow-600 bg-yellow-100";case"suspended":return"text-red-600 bg-red-100";case"rejected":return"text-gray-600 bg-gray-100";default:return"text-gray-600 bg-gray-100"}},I=a=>{switch(a){case"active":return e.jsx(Z,{className:"w-4 h-4"});case"pending":return e.jsx(z,{className:"w-4 h-4"});case"suspended":return e.jsx(E,{className:"w-4 h-4"});case"rejected":return e.jsx(E,{className:"w-4 h-4"});default:return e.jsx(z,{className:"w-4 h-4"})}},O=a=>{switch(a){case"active":return s("userManagement.status.active");case"pending":return s("userManagement.status.pending");case"suspended":return s("userManagement.status.suspended");case"rejected":return s("userManagement.status.rejected");default:return a}},S=a=>{switch(a){case"admin":return s("userManagement.roles.admin");case"moderator":return s("userManagement.roles.moderator");case"sacco":return s("userManagement.roles.sacco");case"authority":return s("userManagement.roles.authority");case"user":return s("userManagement.roles.user");default:return a}},U=F.filter(a=>{var i;const t=a.displayName.toLowerCase().includes(x.toLowerCase())||a.email.toLowerCase().includes(x.toLowerCase())||((i=a.organization)==null?void 0:i.toLowerCase().includes(x.toLowerCase())),o=j==="all"||a.status===j,m=g==="all"||a.role===g||a.requestedRole===g;return t&&o&&m});return T?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:s("userManagement.loading")})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s("userManagement.title")}),e.jsx("p",{className:"text-gray-600 mt-1",children:s("userManagement.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:p,className:"flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{children:s("userManagement.refresh")})]}),e.jsxs("button",{onClick:()=>w(!0),className:"flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:s("userManagement.addUser")})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("userManagement.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:x,onChange:a=>L(a.target.value),placeholder:s("userManagement.searchPlaceholder"),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("userManagement.status")}),e.jsxs("select",{value:j,onChange:a=>q(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:s("userManagement.filters.allStatus")}),e.jsx("option",{value:"active",children:s("userManagement.status.active")}),e.jsx("option",{value:"pending",children:s("userManagement.status.pending")}),e.jsx("option",{value:"suspended",children:s("userManagement.status.suspended")}),e.jsx("option",{value:"rejected",children:s("userManagement.status.rejected")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s("userManagement.role")}),e.jsxs("select",{value:g,onChange:a=>_(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:s("userManagement.filters.allRoles")}),e.jsx("option",{value:"user",children:s("userManagement.roles.user")}),e.jsx("option",{value:"sacco",children:s("userManagement.roles.sacco")}),e.jsx("option",{value:"authority",children:s("userManagement.roles.authority")}),e.jsx("option",{value:"moderator",children:s("userManagement.roles.moderator")}),e.jsx("option",{value:"admin",children:s("userManagement.roles.admin")})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.table.displayName")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.table.role")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.requestedRole")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.table.status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.organization")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.created")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("userManagement.table.actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:U.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(b,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.displayName}),e.jsx("div",{className:"text-sm text-gray-500",children:a.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[k(a.role),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:S(a.role)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.requestedRole?e.jsxs("div",{className:"flex items-center",children:[k(a.requestedRole),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:S(a.requestedRole)})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${B(a.status)}`,children:[I(a.status),e.jsx("span",{className:"ml-1",children:O(a.status)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a.organization||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(a.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[a.status==="pending"&&a.requestedRole&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>P(a._id),disabled:f===a._id,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-white bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[f===a._id?e.jsx(v,{className:"w-3 h-3 animate-spin"}):e.jsx(X,{className:"w-3 h-3"}),e.jsx("span",{className:"ml-1",children:s("userManagement.actions.approve")})]}),e.jsxs("button",{onClick:()=>{const t=prompt("Rejection reason:");t&&$(a._id,t)},disabled:f===a._id,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:opacity-50",children:[e.jsx(H,{className:"w-3 h-3"}),e.jsx("span",{className:"ml-1",children:s("userManagement.actions.reject")})]})]}),e.jsxs("button",{onClick:()=>{y(a._id),d({displayName:a.displayName,email:a.email,role:a.role,status:a.status,organization:a.organization||""})},className:"inline-flex items-center px-3 py-1 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 ml-2",children:[e.jsx(K,{className:"w-3 h-3 mr-1"})," ",s("userManagement.actions.edit")]})]})]},a._id))})]})})}),U.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:s("userManagement.noUsers")}),e.jsx("p",{className:"text-gray-500",children:s("userManagement.noUsersMessage")})]})]}),A&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:s("userManagement.modals.addUser.title")}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"form-input w-full",placeholder:s("userManagement.modals.addUser.fullName"),value:r.displayName,onChange:a=>c({...r,displayName:a.target.value})}),e.jsx("input",{className:"form-input w-full",placeholder:s("userManagement.modals.addUser.email"),value:r.email,onChange:a=>c({...r,email:a.target.value})}),e.jsx("input",{className:"form-input w-full",placeholder:s("userManagement.modals.addUser.password"),type:"password",value:r.password,onChange:a=>c({...r,password:a.target.value})}),e.jsxs("select",{className:"form-select w-full",value:r.role,onChange:a=>c({...r,role:a.target.value}),children:[e.jsx("option",{value:"user",children:s("userManagement.roles.user")}),e.jsx("option",{value:"sacco",children:s("userManagement.roles.sacco")}),e.jsx("option",{value:"authority",children:s("userManagement.roles.authority")}),e.jsx("option",{value:"moderator",children:s("userManagement.roles.moderator")}),e.jsx("option",{value:"admin",children:s("userManagement.roles.admin")})]}),e.jsx("input",{className:"form-input w-full",placeholder:s("userManagement.modals.addUser.organization"),value:r.organization,onChange:a=>c({...r,organization:a.target.value})})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>w(!1),children:s("userManagement.modals.addUser.cancel")}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{try{(await R.adminCreateUser(r)).success&&(w(!1),c({displayName:"",email:"",password:"",role:"user",organization:""}),p())}catch{alert(s("userManagement.messages.createError"))}},children:s("userManagement.modals.addUser.create")})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:s("userManagement.modals.editUser.title")}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"form-input w-full",placeholder:s("userManagement.modals.editUser.fullName"),value:n.displayName,onChange:a=>d({...n,displayName:a.target.value})}),e.jsx("input",{className:"form-input w-full",placeholder:s("userManagement.modals.editUser.email"),value:n.email,onChange:a=>d({...n,email:a.target.value})}),e.jsxs("select",{className:"form-select w-full",value:n.role,onChange:a=>d({...n,role:a.target.value}),children:[e.jsx("option",{value:"user",children:s("userManagement.roles.user")}),e.jsx("option",{value:"sacco",children:s("userManagement.roles.sacco")}),e.jsx("option",{value:"authority",children:s("userManagement.roles.authority")}),e.jsx("option",{value:"moderator",children:s("userManagement.roles.moderator")}),e.jsx("option",{value:"admin",children:s("userManagement.roles.admin")})]}),e.jsxs("select",{className:"form-select w-full",value:n.status,onChange:a=>d({...n,status:a.target.value}),children:[e.jsx("option",{value:"active",children:s("userManagement.status.active")}),e.jsx("option",{value:"pending",children:s("userManagement.status.pending")}),e.jsx("option",{value:"suspended",children:s("userManagement.status.suspended")}),e.jsx("option",{value:"rejected",children:s("userManagement.status.rejected")})]}),e.jsx("input",{className:"form-input w-full",placeholder:s("userManagement.modals.editUser.organization"),value:n.organization,onChange:a=>d({...n,organization:a.target.value})})]}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>y(null),children:s("userManagement.modals.editUser.cancel")}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{try{(await R.adminUpdateUser(C,n)).success&&(y(null),p())}catch{alert(s("userManagement.messages.updateError"))}},children:s("userManagement.modals.editUser.save")})]})]})})]})}export{re as default};
//# sourceMappingURL=UserManagement-BSYUy_uB.js.map
